<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link id="maincss" rel="stylesheet" href="github-markdown.css">
    <link rel="stylesheet" href="exported_wiki.css">
</head>


<body>

<!------------------------------------------------------------------------->
<!-- THE TOC STARTS HERE                                                 -->
<!------------------------------------------------------------------------->

    <div id="toc" class="w3-sidebar w3-border-right">
        <div class="markdown-body">
            <embed>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Gut Wiki</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <link rel="stylesheet" href="github-markdown.css" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header id="title-block-header">
<h1 class="title">Gut Wiki</h1>
</header>
<h3 id="910-godot-41">9.1.0 (Godot 4.1)</h3>
<h3 id="start-here">Start Here</h3>
<ul>
<li><a href="New-For-Godot-4.html">New-For-Godot-4</a></li>
<li><a href="Home.html">Home</a></li>
<li><a href="Quick-Start.html">Quick-Start</a></li>
</ul>
<h3 id="all-pages">All Pages</h3>
<ul>
<li><a href="Asserts-and-Methods.html">Asserts-and-Methods</a></li>
<li><a href="Awaiting.html">Awaiting</a></li>
<li><a href="Command-Line.html">Command-Line</a></li>
<li><a href="Comparing-Things.html">Comparing-Things</a></li>
<li><a href="Contributing.html">Contributing</a></li>
<li><a href="Creating-Tests.html">Creating-Tests</a></li>
<li><a href="Double-Strategy.html">Double-Strategy</a></li>
<li><a href="Doubles.html">Doubles</a></li>
<li><a href="Export-Test-Results.html">Export-Test-Results</a></li>
<li><a href="Home.html">Home</a></li>
<li><a href="Hooks.html">Hooks</a></li>
<li><a href="Inner-Test-Classes.html">Inner-Test-Classes</a></li>
<li><a href="Input-Factory.html">Input-Factory</a></li>
<li><a href="Install.html">Install</a></li>
<li><a href="Memory-Management.html">Memory-Management</a></li>
<li><a href="Mock-Input.html">Mock-Input</a></li>
<li><a href="New-For-Godot-4.html">New-For-Godot-4</a></li>
<li><a href="Orphans.html">Orphans</a></li>
<li><a href="Parameterized-Tests.html">Parameterized-Tests</a></li>
<li><a href="Partial-Doubles.html">Partial-Doubles</a></li>
<li><a href="Quick-Start.html">Quick-Start</a></li>
<li><a href="Running-On-Devices.html">Running-On-Devices</a></li>
<li><a href="Simulate.html">Simulate</a></li>
<li><a href="Spies.html">Spies</a></li>
<li><a href="Stubbing.html">Stubbing</a></li>
<li><a href="Tutorials.html">Tutorials</a></li>
<li><a href="Yielding.html">Yielding</a></li>
</ul>
</body>
</html>

            </embed>
        </div>
    </div>


<!------------------------------------------------------------------------->
<!-- THE PAGE STARTS HERE                                                -->
<!------------------------------------------------------------------------->
    <div class="wiki-div">
        <div class="markdown-body">
            <embed>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Stubbing</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="github-markdown.css" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header id="title-block-header">
<h1 class="title">Stubbing</h1>
</header>
<h5 id="table-of-contents">Table of Contents</h5>
<ul>
<li><a href="#syntax">Syntax</a></li>
<li><a href="#stubbing-based-off-of-parameter-values">Stubbing based off
of parameter values</a></li>
<li><a href="#stubbing-packed-scenes">Stubbing Packed Scenes</a></li>
<li><a href="#stubbing-method-parameter-defaults">Stubbing Method
Parameter Defaults</a></li>
<li><a href="#stubbing-method-parameter-count">Stubbing Method Parameter
Count</a></li>
<li><a href="#stubbing-accessors">Stubbing Accessors</a></li>
</ul>
<hr />
<p>The <code>stub</code> function allows you to set return values for
methods for a doubled script or instance. You can stub any doubled class
to return values. Stubs can be layered to address general and specific
situations.</p>
<p>You can also use <code>stub</code> to set default parameter values
and change the parameter count for a method.</p>
<h1 id="syntax">Syntax</h1>
<div class="sourceCode" id="cb1"><pre
class="sourceCode gdscript"><code class="sourceCode gdscript"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> MyScript <span class="op">=</span> <span class="bu">load</span>(<span class="st">&#39;res://my_script.gd&#39;</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> inst <span class="op">=</span> <span class="fu">double</span>(MyScript).<span class="fu">new</span>()</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">stub</span>(inst, <span class="st">&#39;some_method&#39;</span>).<span class="fu">to_return</span>(<span class="st">&quot;I&#39;m stubbed!&quot;</span>)</span></code></pre></div>
<ul>
<li><code>stub(obj, method)</code> This stubs the value for a method.
You must chain in a call to one of the "to" methods such as
<code>to_return(...)</code>. The first parameter can be a path to a
script or a loaded script or an instance of a doubled object. When you
pass in a path or class, then all doubles of that script will have the
stub by default. You can override this by calling <code>stub</code> on
an instance of a doubled object.</li>
</ul>
<p>After calling <code>stub</code> you must chain one of the following
"to" methods after.</p>
<ul>
<li><code>.to_return(value)</code> Stubs the method to return the passed
value.</li>
<li><code>.to_call_super()</code> This will cause the method to punch
through to the implementation in the super class so it will retain its
original functionality.</li>
<li><code>.to_do_nothing()</code> This is the same as calling
<code>.to_return(null)</code> but it is more readable and shows the
intent of what you are doing.</li>
</ul>
<p>You can optionally chain in the <code>when_passed</code> clause as
well.</p>
<ul>
<li><code>.when_passed(p1, p2, p3....p10)</code> This can optionally be
called on the result of <code>stub</code> in order to stub a value when
specific parameters are passed to the method. It supports up to 10
parameters. Let me know if you need more. For example:</li>
</ul>
<pre><code>stub(&#39;res://script.gd&#39;, &#39;method&#39;).to_return(-5).when_passed(&#39;minus&#39;, &#39;five&#39;)</code></pre>
<p>You can also alter a method's signature with</p>
<ul>
<li><code>.param_defaults([])</code></li>
<li><code>.param_count(x)</code> See below for more information about
setting parameter default values and changing parameter counts.</li>
</ul>
<h2 id="example">Example</h2>
<p>Here is a simple example</p>
<p>Given the <code>double_this</code> class:</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode gdscript"><code class="sourceCode gdscript"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># res://scripts/double_this.gd</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="kw">extends</span> Node2D</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> foo <span class="op">=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> bar <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="fu">returns_seven</span>():</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="dv">7</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="fu">return_hello</span>(param<span class="op">=</span><span class="dv">1</span>):</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="st">&#39;hello&#39;</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> InnerClass:</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> another_foo <span class="op">=</span> <span class="dv">100</span></span></code></pre></div>
<p>Then, from inside your test script you can do the following to alter
the <code>returns_seven</code> method to return <code>500</code></p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode gdscript"><code class="sourceCode gdscript"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> DoubleThis <span class="op">=</span> <span class="bu">load</span>(<span class="st">&#39;res://scripts/double_this.gd&#39;</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="fu">test_something</span>():</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> inst <span class="op">=</span> <span class="fu">double</span>(DoubleThis).<span class="fu">new</span>()</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stub</span>(inst, <span class="st">&#39;returns_seven&#39;</span>).<span class="fu">to_return</span>(<span class="dv">500</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assert_eq</span>(inst.<span class="fu">returns_seven</span>(), <span class="dv">500</span>)</span></code></pre></div>
<p>The <code>stub</code> method is pretty smart about what you pass it.
You can pass it a path, an Object or an instance. If you pass an
instance, it <strong>must</strong> be an instance of a double.</p>
<p>When passed an Object or a path, it will stub the value for
<strong>all</strong> instances that do not have explicitly defined
stubs. When you pass it an instance of a doubled class, then the stubbed
return will only be set for that instance.</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode gdscript"><code class="sourceCode gdscript"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> DoubleThis <span class="op">=</span> <span class="bu">load</span>(<span class="st">&#39;res://scripts/double_this.gd&#39;</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> Doubled <span class="op">=</span> <span class="fu">double</span>(DoubleThis)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># These two are equivalent, and stub returns_seven for any doubles of</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co"># DoubleThis to return 500.</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="fu">stub</span>(<span class="st">&#39;res://scripts/double_this.gd&#39;</span>, <span class="st">&#39;returns_seven&#39;</span>).<span class="fu">to_return</span>(<span class="dv">500</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="fu">stub</span>(DoubleThis, <span class="st">&#39;returns_seven&#39;</span>).<span class="fu">to_return</span>(<span class="dv">500</span>)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> inst <span class="op">=</span> Doubled.<span class="fu">new</span>()</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="fu">assert_eq</span>(inst.<span class="fu">returns_seven</span>(), <span class="dv">500</span>)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co"># This will stub returns_seven on the passed in instance ONLY.</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Any other instances will return 500 from the lines above.</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> stub_again <span class="op">=</span> Doubled.<span class="fu">new</span>()</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="fu">stub</span>(stub_again, <span class="st">&#39;returns_seven&#39;</span>).<span class="fu">to_return</span>(<span class="st">&#39;words&#39;</span>)</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="fu">assert_eq</span>(stub_again.<span class="fu">returns_seven</span>(), <span class="st">&#39;words&#39;</span>)</span></code></pre></div>
<h1 id="stubbing-based-off-of-parameter-values">Stubbing based off of
parameter values</h1>
<p>You can stub a method to return a specific value based on what was
passed in.</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode gdscript"><code class="sourceCode gdscript"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> DoubleThis <span class="op">=</span> <span class="bu">load</span>(<span class="st">&#39;res://scripts/double_this.gd&#39;</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> Doubled <span class="op">=</span> <span class="fu">double</span>(DoubleThis)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">stub</span>(DoubleThis, <span class="st">&#39;return_hello&#39;</span>).<span class="fu">to_return</span>(<span class="st">&#39;world&#39;</span>).<span class="fu">when_passed</span>(<span class="st">&#39;hello&#39;</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> inst <span class="op">=</span> Doubled.<span class="fu">new</span>()</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="fu">assert_eq</span>(inst.<span class="fu">return_hello</span>(), <span class="st">&#39;hello&#39;</span>)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="fu">assert_eq</span>(inst.<span class="fu">return_hello</span>(<span class="st">&#39;hello&#39;</span>), <span class="st">&#39;world&#39;</span>)</span></code></pre></div>
<p>The ordering of <code>when_passed</code> and <code>to_return</code>
does not matter.</p>
<h1 id="stubbing-packed-scenes">Stubbing Packed Scenes</h1>
<p>When stubbing doubled scenes, use the path to the scene,
<strong>not</strong> the path to the scene's script. If you double and
stub the script used by the scene, the <code>instance</code> you make
from <code>double_scene</code> will not return values stubbed for the
script. It will only return values stubbed for the scene.</p>
<p>In order for a scene to be doubled, the scene's script must be able
to be instantiated with <code>new</code> with zero parameters
passed.</p>
<h2 id="example-1">Example</h2>
<p>Given the script <code>res://the_script.gd</code>:</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode gdscript"><code class="sourceCode gdscript"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="fu">return_hello</span>():</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="st">&#39;hello&#39;</span></span></code></pre></div>
<p>And given a scene with the path
<code>res://double_this_scene.tscn</code> which has its script set to
<code>res://the_script.gd</code>.</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode gdscript"><code class="sourceCode gdscript"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> DoubleThisScene <span class="op">=</span> <span class="bu">load</span>(<span class="st">&#39;res://double_this_scene.tscn&#39;</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="fu">test_illustrate_stubbing_scenes</span>():</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> doubled_scene <span class="op">=</span> <span class="fu">double</span>(DoubleThisScene).<span class="fu">instantiate</span>()</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stub</span>(doubled_scene, <span class="st">&#39;return_hello&#39;</span>).<span class="fu">to_return</span>(<span class="st">&#39;world&#39;</span>)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assert_eq</span>(doubled_scene.<span class="fu">return_hello</span>(), <span class="st">&#39;world&#39;</span>)</span></code></pre></div>
<h1 id="stubbing-method-parameter-defaults">Stubbing Method Parameter
Defaults</h1>
<p>Godot only provides information about default values for built in
methods so Gut doesn't know what any default values are for methods you
have created. Since it can't know, Gut defaults all parameters to
<code>null</code>. This can cause issues in specific cases (probably all
involving calling super). You can use <code>.param_defaults</code> to
specify default values to be used.</p>
<p>Here's an example where things go wrong</p>
<pre><code># res://foo.gd
var _sum  = 0
func increment(inc_by=1):
  _sum += inc_by

func go_up_one():
  increment()

func get_sum():
  return _sum</code></pre>
<p>The following test will cause a
<code>Invalid operands 'int' and 'Nil'</code> error. This is because
increment's <code>inc_by</code> parameter is defaulted to
<code>null</code> in the double.</p>
<pre><code>var Foo = load(&#39;res://foo.gd&#39;)
test_go_up_one_increments_sum_by_1():
  var dbl_foo = double(Foo).new()
  stub(dbl_foo, &#39;go_up_one&#39;).to_call_super()

  dbl_foo.go_up_one()
  assert_called(dbl_foo, &#39;increment&#39;, [1])</code></pre>
<p>The fix is to add a <code>param_defaults</code> stub</p>
<pre><code>stub(dbl_foo, &#39;increment&#39;).param_defaults([1])</code></pre>
<h1 id="stubbing-method-parameter-count">Stubbing Method Parameter
Count</h1>
<p><u><strong>Changing the number of parameters must be done before
<code>double</code> is called</strong></u></p>
<p>Some built-in methods have <code>vararg</code> parameters. This makes
the parameter list dynamic. Godot does not provide this information.
This can cause errors due to a signature mismatch. Your code might be
calling a method using 10 parameter values but Gut only sees two.</p>
<p>Let's take <code>Node.rpc_id</code> for example. It has two normal
parameters and then a vararg of strings as the last parameter.</p>
<pre><code>Variant rpc_id(peer_id: int, method: String, ...) vararg</code></pre>
<p>If this method gets called in a partial double with more than 2
parameters Godot will will throw <em>Invalid call to function 'rpc_id'
in base 'Control ()'. Expected 2 arguments.</em></p>
<p>You can use <code>.param_count(x)</code> to tell Gut to give the
method any number of extra parameters. You cannot make the method have
less parameters. You must do this before you call
<code>double</code>.</p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode gdscript"><code class="sourceCode gdscript"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="fu">test_issue_246_rpc_id_varargs</span>():</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># must happen before double is called</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stub</span>(Node, <span class="st">&#39;rpc_id&#39;</span>).<span class="fu">to_do_nothing</span>().<span class="fu">param_count</span>(<span class="dv">5</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> inst <span class="op">=</span> <span class="fu">double</span>(Node).<span class="fu">new</span>()</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  inst.<span class="fu">rpc_id</span>(<span class="dv">1</span>, <span class="st">&#39;foo&#39;</span>, <span class="st">&#39;3&#39;</span>, <span class="st">&#39;4&#39;</span>, <span class="st">&#39;5&#39;</span>)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assert_called</span>(inst, <span class="st">&#39;rpc_id&#39;</span>, [<span class="dv">1</span>, <span class="st">&#39;foo&#39;</span>, <span class="st">&#39;3&#39;</span>, <span class="st">&#39;4&#39;</span>, <span class="st">&#39;5&#39;</span>])</span></code></pre></div>
<p>You can also use <code>.param_defaults</code> to specify extra
parameters if you supply more defaults than the method has
parameters.</p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode gdscript"><code class="sourceCode gdscript"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="fu">test_issue_246_rpc_id_varargs_with_defaults</span>():</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># must happen before double is called</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stub</span>(Node, <span class="st">&#39;rpc_id&#39;</span>).<span class="fu">to_do_nothing</span>().<span class="fu">param_defaults</span>([<span class="va">null</span>, <span class="va">null</span>, <span class="st">&#39;a&#39;</span>, <span class="st">&#39;b&#39;</span>, <span class="st">&#39;c&#39;</span>])</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> inst <span class="op">=</span> <span class="fu">double</span>(Node).<span class="fu">new</span>()</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  inst.<span class="fu">rpc_id</span>(<span class="dv">1</span>, <span class="st">&#39;foo&#39;</span>, <span class="st">&#39;z&#39;</span>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assert_called</span>(inst, <span class="st">&#39;rpc_id&#39;</span>, [<span class="dv">1</span>, <span class="st">&#39;foo&#39;</span>, <span class="st">&#39;z&#39;</span>, <span class="st">&#39;b&#39;</span>, <span class="st">&#39;c&#39;</span>])</span></code></pre></div>
<p>You cannot make a method have less parameters, only more.</p>
<h1 id="stubbing-accessors">Stubbing Accessors</h1>
<p>It is not possible to stub the accessors for properties if you do not
use a secondary method for the accessors. This means that doubles retain
the functionality of the accessors, and it cannot be changed.</p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode gdscript"><code class="sourceCode gdscript"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The get and set for my_property cannot be stubbed.  Doubles retain the</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co"># functionality of the get and set methods.</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> my_property <span class="op">=</span> <span class="st">&#39;foo&#39;</span> :</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  get: <span class="cf">return</span> my_property</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set</span>(val): my_property <span class="op">=</span> val</span></code></pre></div>
<p>If you use secondary methods, you can stub the behavior, but all
doubles will not have any functionality for the accessors by
default.</p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode gdscript"><code class="sourceCode gdscript"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># You can stub _get_my_property and _set_my_property.  Doubles of this do not</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co"># retain the functionality of the accessors.  _get_my_property and</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co"># _set_my_property must be stubbed to_call_super to actually return or set</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># the value of my_property.</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> my_property <span class="op">=</span> <span class="st">&#39;foo&#39;</span> :</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  get: <span class="co">_get_my_property</span>, set: <span class="co">_set_my_property</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="fu">_get_my_property</span>():</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> my_property</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="fu">_set_my_property</span>(val):</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  my_property <span class="op">=</span> val</span></code></pre></div>
</body>
</html>

            </embed>
        </div>
    </div>

</body>

</html>