<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link id="maincss" rel="stylesheet" href="github-markdown.css">
    <link rel="stylesheet" href="exported_wiki.css">
</head>


<body>

<!------------------------------------------------------------------------->
<!-- THE TOC STARTS HERE                                                 -->
<!------------------------------------------------------------------------->

    <div id="toc" class="w3-sidebar w3-border-right">
        <div class="markdown-body">
            <embed>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Gut Wiki</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <link rel="stylesheet" href="github-markdown.css" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header id="title-block-header">
<h1 class="title">Gut Wiki</h1>
</header>
<h3 id="901-godot-4x">9.0.1 (Godot 4.x)</h3>
<h3 id="start-here">Start Here</h3>
<ul>
<li><a href="New-For-Godot-4.html">New-For-Godot-4</a></li>
<li><a href="Home.html">Home</a></li>
<li><a href="Quick-Start.html">Quick-Start</a></li>
</ul>
<h3 id="all-pages">All Pages</h3>
<ul>
<li><a href="Asserts-and-Methods.html">Asserts-and-Methods</a></li>
<li><a href="Command-Line.html">Command-Line</a></li>
<li><a href="Comparing-Things.html">Comparing-Things</a></li>
<li><a href="Contributing.html">Contributing</a></li>
<li><a href="Creating-Tests.html">Creating-Tests</a></li>
<li><a href="Double-Strategy.html">Double-Strategy</a></li>
<li><a href="Doubles.html">Doubles</a></li>
<li><a href="Export-Test-Results.html">Export-Test-Results</a></li>
<li><a href="Home.html">Home</a></li>
<li><a href="Hooks.html">Hooks</a></li>
<li><a href="Inner-Test-Classes.html">Inner-Test-Classes</a></li>
<li><a href="Input-Factory.html">Input-Factory</a></li>
<li><a href="Install.html">Install</a></li>
<li><a href="Memory-Management.html">Memory-Management</a></li>
<li><a href="Mock-Input.html">Mock-Input</a></li>
<li><a href="New-For-Godot-4.html">New-For-Godot-4</a></li>
<li><a href="Orphans.html">Orphans</a></li>
<li><a href="Parameterized-Tests.html">Parameterized-Tests</a></li>
<li><a href="Partial-Doubles.html">Partial-Doubles</a></li>
<li><a href="Quick-Start.html">Quick-Start</a></li>
<li><a href="Running-On-Devices.html">Running-On-Devices</a></li>
<li><a href="Simulate.html">Simulate</a></li>
<li><a href="Spies.html">Spies</a></li>
<li><a href="Stubbing.html">Stubbing</a></li>
<li><a href="Tutorials.html">Tutorials</a></li>
<li><a href="Yielding.html">Yielding</a></li>
</ul>
</body>
</html>

            </embed>
        </div>
    </div>


<!------------------------------------------------------------------------->
<!-- THE PAGE STARTS HERE                                                -->
<!------------------------------------------------------------------------->
    <div class="wiki-div">
        <div class="markdown-body">
            <embed>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Doubles</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="github-markdown.css" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header id="title-block-header">
<h1 class="title">Doubles</h1>
</header>
<p>If you aren't sure what a Double is, check out <a
href="https://en.wikipedia.org/wiki/Test_double">https://en.wikipedia.org/wiki/Test_double</a>.</p>
<p>The <code>double</code> method accepts a loaded script or scene and
returns a class based on the loaded script or scene passed to it. The
returned class/scene wraps the source and the methods defined will not
execute the code defined in them. These doubles can then be <a
href="Stubbing.html">stubbed</a> and <a href="Spies.html">spied on</a>
in tests. You can also create <a href="Partial-Doubles.html">Partial
Doubles</a> which retain their functionality by default.</p>
<p>Using your double, you can:</p>
<ul>
<li>Stub methods to return different values.</li>
<li>Stub them to call the super method.</li>
<li>Assert how many times a method was called.</li>
<li>Assert a method was called with specific parameters.</li>
<li>And much much more. See <a href="Stubbing.html">Stubbing</a> and <a
href="Spies.html">Spies</a> for more infomration.</li>
</ul>
<h1 id="characteristics-of-a-double">Characteristics of a Double</h1>
<ul>
<li>The double inherits (<code>extends</code>) the source.</li>
<li>Contains all class level variables defined in the source.</li>
<li>Contains all signals defined in the source.</li>
<li>Methods defined in the source (and any user defined super class):
<ul>
<li>Do nothing (unless stubbed).</li>
<li>Will return <code>null</code> (unless stubbed).</li>
<li><strong>All</strong> parameters are defaulted to <code>null</code>,
even if they did not have a default value originally. You can stub
parameter defaults.</li>
</ul></li>
<li>Methods defined in any Godot super class (such as <code>Node</code>
or <code>Control</code>) are not altered unless those methos have been
overridden. This is overridable by chaninging the <a
href="Double-Strategy.html">Double-Strategy</a>.</li>
<li>Inner Classes of the source are not doubled and will retain their
functionality.</li>
<li>You can double Inner Classes, but it requires an extra step. See the
Inner Class section below.</li>
<li>If your <code>_init</code> method has required parameters you must
<a href="Stubbing.html">stub</a> default values before trying to
<code>double</code> the object.</li>
<li>Static mehtods must be ignored before doubling using
<code>ignore_method_when_doubling</code>. More information about this
below.</li>
<li>All <strong>instances</strong> of Doubles and Partial Dobules are
freed after a test finishes. This means you do not have to free them
manually and you should not use them in <code>before_all</code>.</li>
<li>You can double Scripts, Inner Classes, and Packed Scenes. Once you
have a double, you can then call <code>new</code> or
<code>instantiate</code> on it to create instances of a doubled
object.</li>
</ul>
<h1 id="doubling-a-script">Doubling a Script</h1>
<p>To double a script just give it a path or an already loaded
script.</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode gdscript"><code class="sourceCode gdscript"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> MyScript <span class="op">=</span> <span class="bu">load</span>(<span class="st">&#39;res://my_script.gd&#39;</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the doubled object.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> DoubledMyScript <span class="op">=</span> <span class="fu">double</span>(MyScript)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an instance of a doubled object</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> doubled_script <span class="op">=</span> DoubledMyScript.<span class="fu">new</span>()</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># or</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> doubled_script <span class="op">=</span> <span class="fu">double</span>(MyScript).<span class="fu">new</span>()</span></code></pre></div>
<h1 id="doubling-inner-classes">Doubling Inner Classes</h1>
<p>Inner Classes cannot be automatically detected and therefore must be
registered with GUT before they can be doubled. You do this by calling
<code>register_inner_classes(Foo)</code>. You only have to do this once
per script/scene that contains Inner Classes, so it is best to call it
in <code>before_all</code> or a pre-hook script. Registering multiple
times does nothing. Failing to call <code>register_inner_classes</code>
will result in a GUT error and a runtime error.</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode gdscript"><code class="sourceCode gdscript"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Given that SomeScript contains the class InnerClass that</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># you wish to to double:</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> SomeScript <span class="op">=</span> <span class="bu">load</span>(<span class="st">&#39;res://some_script.gd&#39;</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="fu">before_all</span>():</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">register_inner_classes</span>(SomeScript)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="fu">test_foo</span>():</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> dbl <span class="op">=</span> <span class="fu">double</span>(SomeScript.InnerClass).<span class="fu">new</span>()</span></code></pre></div>
<p>This approach was used to make tests cleaner and less susceptible to
typos. If Godot adds meta data to inner classes that point back to the
source script, then <code>register_inner_classes</code> can be removed
later and no other changes will need to be made.</p>
<h1 id="doubling-a-scene">Doubling a Scene</h1>
<p>A doubled version of your scene is created along with a double of its
script. The doubled scene is altered to load the doubled script instead
of the original. A reference to the newly doubled scene is returned. You
can call <code>instantiate</code> on the returned reference.</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode gdscript"><code class="sourceCode gdscript"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> MyScene <span class="op">=</span> <span class="bu">load</span>(<span class="st">&#39;res://my_scene.tscn&#39;</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> DoubledScene <span class="op">=</span> <span class="fu">double</span>(MyScene)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an instance</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> doubled_scene <span class="op">=</span> DoubledScene.<span class="fu">instantiate</span>()</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># or</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> doubled_scene <span class="op">=</span> <span class="fu">double</span>(MyScene).<span class="fu">instantiate</span>()</span></code></pre></div>
<h1 id="doubling-scripts-with-static-methods">Doubling Scripts with
Static Methods</h1>
<p>Currently you cannot double static methods. In fact if you try to
double a class with a static method then you will get an error that
looks similar to:</p>
<pre><code>Parser Error: Function signature doesn&#39;t match the parent. Parent signature is: &#39;Variant foo()&#39;.</code></pre>
<p>As of now, GUT does not have the ability to detect static methods in
the code. As a workaround there is the
<code>ignore_method_when_doubling</code> method. This method takes in a
variant as the first parameter and a method name as the second. The
first parameter can be a path to a script, a path to a scene, a loaded
script, or a loaded scene.</p>
<p>Calling this method will prevent GUT from trying to make a stubbed
out version of the method in the generated double allowing you to
successfully double your classes that contain static methods.</p>
<p>These ignored methods are cleared after each test is ran to avoid any
unexpected results in your tests, so you may want to add this call to
your <code>before_each</code>.</p>
<p>There's more info and examples on this method on the
[[Methods|Asserts-and-Methods]] page.</p>
<h1
id="methods-with-varargs-and-nativescript-parameter-mismatches">Methods
with varargs and NativeScript parameter mismatches</h1>
<p>Some methods provided by Godot can contain and endless list of
parameters (varargs). Trying to call one of these methods on a double
can result in runtime errors due to a paramter mismatch. See the
sections in <a href="Stubbing.html">Stubbing</a> that address
parameters.</p>
<p>Sometimes NativeScript parameters aren't found in doubles (maybe
always). This helps there too.</p>
<p>For even more reading see issues #252 and #246.</p>
<h1 id="doubled-method-default-parameters">Doubled method default
parameters</h1>
<p>GUT stubs all parameters in doubled user methods to be
<code>null</code>. This is because Godot only provides defaults for
built-in methods. When using partial-doubles or stubbing a method
<code>to_call_super</code> <code>null</code> can get passed around when
you wouldn't expect it causing errors such as
<code>Invalid operands 'int' and 'Nil'</code>. See the "Stubbing Method
Paramter Defaults" in <a href="Stubbing.html">Stubbing</a> for a way to
stub method default values.</p>
<h1 id="doubling-built-ins">Doubling Built-Ins</h1>
<p>You can <code>double</code> built-in objects that are not inherited
by a script such as a <code>Node2D</code> or a <code>Raycast2D</code>.
These doubles are always created using the Doubling Strategy of
"INCLUDE_SUPER" (see <a
href="Double-Strategy.html">Double-Strategy</a>).</p>
<p>For example you can <code>double</code> or
<code>partial_double</code> like this:</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode gdscript"><code class="sourceCode gdscript"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> doubled_node2d <span class="op">=</span> <span class="fu">double</span>(Node2D).<span class="fu">new</span>()</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">stub</span>(doubled_node2d, <span class="st">&#39;get_position&#39;</span>).<span class="fu">to_return</span>(<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> partial_doubled_raycast <span class="op">=</span> <span class="fu">partial_double</span>(Raycast2D).<span class="fu">new</span>()</span></code></pre></div>
<h2 id="example-of-script-vs-built-in-doubling">Example of Script vs
Built-in doubling</h2>
<p>Only methods that have been defined in the script you pass in OR
methods that have been defined in parent scripts get the empty
implementation in the double. Methods defined in any built-in Godot
class do not get overridden <strong>unless</strong> the script (or
parent script(s)) have them implemented.</p>
<p>This is in the process of being changed but it is not fully
implemented yet. See the section on Double Strategies.</p>
<p>For example, given the following script at location
<code>res://example.gd</code></p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode gdscript"><code class="sourceCode gdscript"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">extends</span> Node2D</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> <span class="co">_value</span> <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="fu">set_position</span>(pos):</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">&#39;setting position&#39;</span>)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  .<span class="fu">set_position</span>(pos)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="fu">get_value</span>():</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="co">_value</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="fu">set_value</span>(value):</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">_value</span> <span class="op">=</span> value</span></code></pre></div>
<p>And, in a test, you double this class:</p>
<pre><code>  var Doubled = double(&#39;res://example.gd&#39;)
  var doubled = Doubled.new()</code></pre>
<p>Then:</p>
<ul>
<li>You can stub <code>get_value</code>, <code>set_value</code>,
<code>set_position</code>.</li>
<li>You <strong>cannot</strong> stub <code>get_position</code> since
this class does not implement it. This will result in a runtime
error.</li>
<li>You can use <code>assert_method(doubled, 'get_value')</code></li>
<li>You <strong>should not</strong> use
<code>assert_method(doubled, 'get_position')</code>. <em>You can but it
will always return 0.</em></li>
</ul>
<h1 id="where-to-next">Where to next?</h1>
<ul>
<li><a href="Stubbing.html">Stubbing</a></li>
<li><a href="Spies.html">Spies</a></li>
<li><a href="Partial-Doubles.html">Parital-Doubles</a></li>
<li><a href="Double-Strategy.html">Double-Strategy</a></li>
</ul>
</body>
</html>

            </embed>
        </div>
    </div>

</body>

</html>