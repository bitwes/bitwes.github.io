
        <html><head>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <style>
            .markdown-body {
                box-sizing: border-box;
                min-width: 200px;
                max-width: 980px;
                margin: 0 auto;
                padding: 45px;
            }

            @media (max-width: 767px) {
                .markdown-body {
                    padding: 15px;
                }
            }
        </style>
        <link rel="stylesheet" href="github-markdown.css"/>
</head><body><article class="markdown-body"><h1><a id="user-content-comparing-things" class="anchor" aria-hidden="true" href="#comparing-things"><span aria-hidden="true" class="octicon octicon-link"></span></a>Comparing-Things</h1>
<h1><a id="user-content-overview" class="anchor" aria-hidden="true" href="#overview"><span aria-hidden="true" class="octicon octicon-link"></span></a>Overview</h1>
<p>Comparing values with GUT's asserts works the way you would expect it to in most cases.  Arrays and dictionaries are a little more complicated.  The following methods can help with this:</p>
<ul>
<li><code>compare_shallow</code></li>
<li><code>compare_deep</code></li>
<li>
<a href="Asserts-and-Methods#assert_eq_shallow"><code>assert_eq_shallow</code></a>, <a href="Asserts-and-Methods#assert_ne_shallow"><code>assert_ne_shallow</code></a>
</li>
<li>
<a href="Asserts-and-Methods#assert_eq_deep"><code>assert_eq_deep</code></a>, <a href="Asserts-and-Methods#assert_ne_deep"><code>assert_ne_deep</code></a>
</li>
</ul>
<p>The asserts listed are convenience wrappers around <code>compare_shallow</code> and <code>compare_deep</code>.  In most cases this will be all you need.  If you would like to further inspect the differences with code then or adjust the number of differences displayed then use the "compare" methods.  These methods return a <a href="#CompareResult"><code>CompareResult</code></a> object which is described below.</p>
<h3><a id="user-content-shallow" class="anchor" aria-hidden="true" href="#shallow"><span aria-hidden="true" class="octicon octicon-link"></span></a>Shallow</h3>
<p>A shallow compare will look at each element in a dictionary or array and use the default Godot equivalence logic.  Floats and Integers are never equal.  See <a href="Asserts-and-Methods#assert_eq_shallow"><code>assert_eq_shallow</code></a> for examples.</p>
<h3><a id="user-content-deep" class="anchor" aria-hidden="true" href="#deep"><span aria-hidden="true" class="octicon octicon-link"></span></a>Deep</h3>
<p>A deep compare will recursively compare all values in the dictionary/array and all sub-dictionaries and sub-arrays.  Floats and Integers are never equal.  See <a href="Asserts-and-Methods#assert_eq_deep"><code>assert_eq_deep</code></a> for examples.</p>
<h1><a id="user-content-comparing-arrays" class="anchor" aria-hidden="true" href="#comparing-arrays"><span aria-hidden="true" class="octicon octicon-link"></span></a><a name="user-content-ComparingArrays">Comparing Arrays</a></h1>
<ul>
<li>Godot compares arrays by value with some caveats.
<ul>
<li>Unlike when using <code>==</code>, floats never == integers in an array.</li>
<li>Dictionaries are compared by reference.  Two different dictionaries with the same values are not equal.</li>
</ul>
</li>
<li>Sub arrays are compared the same way.</li>
<li>Cannot compare arrays by reference.</li>
</ul>
<h3><a id="user-content-asserts-and-arrays" class="anchor" aria-hidden="true" href="#asserts-and-arrays"><span aria-hidden="true" class="octicon octicon-link"></span></a>Asserts and Arrays</h3>
<ul>
<li>The <code>assert_eq</code> and <code>assert_ne</code> functions simulate Godot's behavior but have improved output.
<ul>
<li>Up to 30 differences in index values are listed including any missing indexes.</li>
<li>Dictionaries anywhere in the array are compared-by-ref.</li>
<li>Sub-arrays are summarized, the number of indexes that do not match are listed, but each different value is not.</li>
</ul>
</li>
<li>
<code>assert_called</code> and <code>assert_not_called</code> perform deep compares on any parameters specified.</li>
<li>
<code>assert_signal_emitted_with_parameters</code> performs a deep compare on the parameters specified.</li>
<li>
<code>assert_has</code> and <code>assert_does_not_have</code> use Godot's default behavior.</li>
</ul>
<h3><a id="user-content-shallow-1" class="anchor" aria-hidden="true" href="#shallow-1"><span aria-hidden="true" class="octicon octicon-link"></span></a>Shallow</h3>
<p>A shallow compare of arrays acts the same as <code>assert_eq</code>/<code>assert_ne</code>.  Any dictionaries in the array or sub-arrays will be compared by reference.  Floats and Integers are never equal.</p>
<h3><a id="user-content-deep-1" class="anchor" aria-hidden="true" href="#deep-1"><span aria-hidden="true" class="octicon octicon-link"></span></a>Deep</h3>
<p>A deep compare of arrays will compare all indexes and the values in all sub-arrays/sub-dictionaries found.  Floats and Integers are never equal.</p>
<h1><a id="user-content-comparing-dictionaries" class="anchor" aria-hidden="true" href="#comparing-dictionaries"><span aria-hidden="true" class="octicon octicon-link"></span></a><a name="user-content-ComparingDictionaries">Comparing Dictionaries</a></h1>
<ul>
<li>Godot compares dictionaries by reference.</li>
<li>Dictionary keys are ordered (which is unusual).</li>
<li>The dictionary <code>hash</code> fuction requires dictionary keys be in the same order to generate the same hash so comparing dictionaries by value cannot be done reliably without additional coding.</li>
<li>In order to compare values in dictionary you must use one of the shallow or deep methods listed above.</li>
</ul>
<h3><a id="user-content-asserts-and-dictionaries" class="anchor" aria-hidden="true" href="#asserts-and-dictionaries"><span aria-hidden="true" class="octicon octicon-link"></span></a>Asserts and Dictionaries</h3>
<ul>
<li>The <code>assert_eq</code> and <code>assert_ne</code> uses Godot's default behavior and compares them by reference.</li>
<li>
<code>assert_called</code> and <code>assert_not_called</code> perform deep compares on any parameters specified.</li>
<li>
<code>assert_signal_emitted_with_parameters</code> performs a deep compare on the parameters specified.</li>
<li>
<code>assert_has</code> and <code>assert_does_not_have</code> use Godot's default behavior.</li>
</ul>
<h3><a id="user-content-shallow-2" class="anchor" aria-hidden="true" href="#shallow-2"><span aria-hidden="true" class="octicon octicon-link"></span></a>Shallow</h3>
<p>A shallow compare of dictionaries will compare all values found in the dictionary.  Sub-dictionaries are compared by value.  Sub-arrays are compared with <code>==</code>.  Floats and Integers are never equal.</p>
<h3><a id="user-content-deep-2" class="anchor" aria-hidden="true" href="#deep-2"><span aria-hidden="true" class="octicon octicon-link"></span></a>Deep</h3>
<p>A  deep compare of dictionaries will compare all keys and the values  in all sub-arrays/sub-dictionaries found.  Floats and Integers are never equal.</p>
<h1><a id="user-content--compareresult" class="anchor" aria-hidden="true" href="#-compareresult"><span aria-hidden="true" class="octicon octicon-link"></span></a><a name="user-content-CompareResult"> CompareResult</a></h1>
<p>A CompareResult object is returned from <code>compare_shallow</code> and <code>compare_deep</code>.  You can use this object to further inspect the differences or adjust the output.</p>
<h3><a id="user-content-properties" class="anchor" aria-hidden="true" href="#properties"><span aria-hidden="true" class="octicon octicon-link"></span></a>Properties</h3>
<ul>
<li>
<code>are_equal</code>: returns <code>true</code>/<code>false</code> if the two objects are equal based on the kind of comparison performed.</li>
<li>
<code>summary</code>: returrns a string of all the differences found.  This will display <code>max_differences</code> differences.  When performing a deep compare, it will also display <code>max_differences</code> per each sub-array/sub-dictionary. This is returned if you use <code>str</code> on a <code>CompareResult</code>.</li>
<li>
<code>max_differences</code>:  The number of differences to display.  This only affects output, all differences are accessible from the <code>differences</code> property.  Set this to -1 to show the maximum number of differences (10,000)</li>
<li>
<code>differences</code>:  This is a dictionary of all the keys/indexes that are different between the compared items.  The key is the key/index that is different.  Keys/indexes that are missing from one of the compared objects are included.  The value of each index is a <code>CompareResult</code>.
<br><br>
<code>CompareResult</code>s for sub-arrays/sub-dictionaries <code>differences</code> will contain all their differences.  You can use  the <code>differences</code> property for that key to dig deeper into the differences.  <code>differences</code> will be an empty dictionary for any element that is not an array or dictionary.</li>
</ul>
<h2><a id="user-content-examples" class="anchor" aria-hidden="true" href="#examples"><span aria-hidden="true" class="octicon octicon-link"></span></a>Examples</h2>
<h3><a id="user-content-deep-array-compare" class="anchor" aria-hidden="true" href="#deep-array-compare"><span aria-hidden="true" class="octicon octicon-link"></span></a>Deep array compare:</h3>
<div class="highlight highlight-source-gdscript"><pre><span class="pl-k">var</span> a1 <span class="pl-k">=</span> [
    [<span class="pl-c1">1</span>, <span class="pl-c1">2</span>, <span class="pl-c1">3</span>, <span class="pl-c1">4</span>],
    [[<span class="pl-c1">4</span>, <span class="pl-c1">5</span>, <span class="pl-c1">6</span>], [<span class="pl-s">'same'</span>], [<span class="pl-c1">7</span>, <span class="pl-c1">8</span>, <span class="pl-c1">9</span>]]
]
<span class="pl-k">var</span> a2 <span class="pl-k">=</span> [
    [<span class="pl-s">"1"</span>, <span class="pl-c1">2.0</span>, <span class="pl-c1">13</span>],
    [[<span class="pl-c1">14</span>, <span class="pl-c1">15</span>, <span class="pl-c1">16</span>], [<span class="pl-s">'same'</span>], [<span class="pl-c1">17</span>, <span class="pl-c1">18</span>, <span class="pl-c1">19</span>]]
]
<span class="pl-k">var</span> result <span class="pl-k">=</span> <span class="pl-c1">compare_deep</span>(a1, a2)
<span class="pl-c1">print</span>(result.summary)

<span class="pl-c1">print</span>(<span class="pl-s">'Traversing differences:'</span>)
<span class="pl-c1">print</span>(result.differences[<span class="pl-c1">1</span>].differences[<span class="pl-c1">2</span>].differences[<span class="pl-c1">0</span>])</pre></div>
<p>Output</p>
<pre><code>[[1, 2, 3, 4], [[4, 5, 6], [same], [7, 8...7, 8, 9]]] != [[1, 2, 13], [[14, 15, 16], [same], [17,... 18, 19]]]  2 of 2 indexes do not match.
    [
        0:  [
            0:  1 != "1".  Cannot compare Int with String.
            1:  2 != 2.0.  Cannot compare Int with Float/Real.
            2:  3 != 13
            3:  4 != &lt;missing index&gt;
        ]
        1:  [
            0:  [
                0:  4 != 14
                1:  5 != 15
                2:  6 != 16
            ]
            2:  [
                0:  7 != 17
                1:  8 != 18
                2:  9 != 19
            ]
        ]
    ]
Traversing differences:
7 != 17
</code></pre>
<h3><a id="user-content-deep-dictionary-compare" class="anchor" aria-hidden="true" href="#deep-dictionary-compare"><span aria-hidden="true" class="octicon octicon-link"></span></a>Deep Dictionary Compare</h3>
<div class="highlight highlight-source-gdscript"><pre><span class="pl-k">var</span> v1 <span class="pl-k">=</span> {<span class="pl-s">'a'</span>:{<span class="pl-s">'b'</span>:{<span class="pl-s">'c'</span>:{<span class="pl-s">'d'</span>:<span class="pl-c1">1</span>}}}}
<span class="pl-k">var</span> v2 <span class="pl-k">=</span> {<span class="pl-s">'a'</span>:{<span class="pl-s">'b'</span>:{<span class="pl-s">'c'</span>:{<span class="pl-s">'d'</span>:<span class="pl-c1">2</span>}}}}
<span class="pl-k">var</span> result <span class="pl-k">=</span> <span class="pl-c1">compare_deep</span>(v1, v2)
<span class="pl-c1">print</span>(result.summary)

<span class="pl-c1">print</span>(<span class="pl-s">'Traversing differences:'</span>)
<span class="pl-c1">print</span>(result.differences[<span class="pl-s">'a'</span>].differences[<span class="pl-s">'b'</span>].differences[<span class="pl-s">'c'</span>])</pre></div>
<p>Output</p>
<pre><code>{a:{b:{c:{d:1}}}} != {a:{b:{c:{d:2}}}}  1 of 1 keys do not match.
    {
        a:  {
            b:  {
                c:  {
                    d:  1 != 2
                }
            }
        }
    }
Traversing differences:
{d:1} != {d:2}  1 of 1 keys do not match.
    {
        d:  1 != 2
    }
</code></pre>
<h3><a id="user-content-mix-bag-of-differences" class="anchor" aria-hidden="true" href="#mix-bag-of-differences"><span aria-hidden="true" class="octicon octicon-link"></span></a>Mix Bag of Differences</h3>
<div class="highlight highlight-source-gdscript"><pre><span class="pl-k">var</span> a1 <span class="pl-k">=</span> [
    <span class="pl-s">'a'</span>, <span class="pl-s">'b'</span>, <span class="pl-s">'c'</span>,
    [<span class="pl-c1">1</span>, <span class="pl-c1">2</span>, <span class="pl-c1">3</span>, <span class="pl-c1">4</span>],
    {<span class="pl-s">'a'</span>:<span class="pl-c1">1</span>, <span class="pl-s">'b'</span>:<span class="pl-c1">2</span>, <span class="pl-s">'c'</span>:<span class="pl-c1">3</span>},
    [{<span class="pl-s">'a'</span>:<span class="pl-c1">1</span>}, {<span class="pl-s">'b'</span>:<span class="pl-c1">2</span>}]
]
<span class="pl-k">var</span> a2 <span class="pl-k">=</span> [
    <span class="pl-s">'a'</span>, <span class="pl-c1">2</span>, <span class="pl-s">'c'</span>,
    [<span class="pl-s">'a'</span>, <span class="pl-c1">2</span>, <span class="pl-c1">3</span>, <span class="pl-s">'d'</span>],
    {<span class="pl-s">'a'</span>:<span class="pl-c1">11</span>, <span class="pl-s">'b'</span>:<span class="pl-c1">12</span>, <span class="pl-s">'c'</span>:<span class="pl-c1">13</span>},
    [{<span class="pl-s">'a'</span>:<span class="pl-s">'diff'</span>}, {<span class="pl-s">'b'</span>:<span class="pl-c1">2</span>}]
]
<span class="pl-k">var</span> result <span class="pl-k">=</span> <span class="pl-c1">compare_deep</span>(a1, a2)
<span class="pl-c1">print</span>(result.summary)

<span class="pl-c1">print</span>(<span class="pl-s">'Traversing differences:'</span>)
<span class="pl-c1">print</span>(result.differences[<span class="pl-c1">5</span>].differences[<span class="pl-c1">0</span>].differences[<span class="pl-s">'a'</span>])
</pre></div>
<p>Output</p>
<pre><code>[a, b, c, [1, 2, 3, 4], {a:1, b:2, c:3},...}, {b:2}]] != [a, 2, c, [a, 2, 3, d], {a:11, b:12, c:1...}, {b:2}]]  4 of 6 indexes do not match.
    [
        1:  "b" != 2.  Cannot compare String with Int.
        3:  [
            0:  1 != "a".  Cannot compare Int with String.
            3:  4 != "d".  Cannot compare Int with String.
        ]
        4:  {
            a:  1 != 11
            b:  2 != 12
            c:  3 != 13
        }
        5:  [
            0:  {
                a:  1 != "diff".  Cannot compare Int with String.
            }
        ]
    ]
    Traversing differences:
    1 != "diff".  Cannot compare Int with String.
</code></pre>
</article></body>