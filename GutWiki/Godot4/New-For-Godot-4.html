<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link id="maincss" rel="stylesheet" href="github-markdown.css">
    <link rel="stylesheet" href="exported_wiki.css">
</head>


<body>

<!------------------------------------------------------------------------->
<!-- THE TOC STARTS HERE                                                 -->
<!------------------------------------------------------------------------->

    <div id="toc" class="w3-sidebar w3-border-right">
        <div class="markdown-body">
            <embed>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Gut Wiki</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <link rel="stylesheet" href="github-markdown.css" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header id="title-block-header">
<h1 class="title">Gut Wiki</h1>
</header>
<h3 id="901-godot-4x">9.0.1 (Godot 4.x)</h3>
<h3 id="start-here">Start Here</h3>
<ul>
<li><a href="New-For-Godot-4.html">New-For-Godot-4</a></li>
<li><a href="Home.html">Home</a></li>
<li><a href="Quick-Start.html">Quick-Start</a></li>
</ul>
<h3 id="all-pages">All Pages</h3>
<ul>
<li><a href="Asserts-and-Methods.html">Asserts-and-Methods</a></li>
<li><a href="Command-Line.html">Command-Line</a></li>
<li><a href="Comparing-Things.html">Comparing-Things</a></li>
<li><a href="Contributing.html">Contributing</a></li>
<li><a href="Creating-Tests.html">Creating-Tests</a></li>
<li><a href="Double-Strategy.html">Double-Strategy</a></li>
<li><a href="Doubles.html">Doubles</a></li>
<li><a href="Export-Test-Results.html">Export-Test-Results</a></li>
<li><a href="Home.html">Home</a></li>
<li><a href="Hooks.html">Hooks</a></li>
<li><a href="Inner-Test-Classes.html">Inner-Test-Classes</a></li>
<li><a href="Input-Factory.html">Input-Factory</a></li>
<li><a href="Install.html">Install</a></li>
<li><a href="Memory-Management.html">Memory-Management</a></li>
<li><a href="Mock-Input.html">Mock-Input</a></li>
<li><a href="New-For-Godot-4.html">New-For-Godot-4</a></li>
<li><a href="Orphans.html">Orphans</a></li>
<li><a href="Parameterized-Tests.html">Parameterized-Tests</a></li>
<li><a href="Partial-Doubles.html">Partial-Doubles</a></li>
<li><a href="Quick-Start.html">Quick-Start</a></li>
<li><a href="Running-On-Devices.html">Running-On-Devices</a></li>
<li><a href="Simulate.html">Simulate</a></li>
<li><a href="Spies.html">Spies</a></li>
<li><a href="Stubbing.html">Stubbing</a></li>
<li><a href="Tutorials.html">Tutorials</a></li>
<li><a href="Yielding.html">Yielding</a></li>
</ul>
</body>
</html>

            </embed>
        </div>
    </div>


<!------------------------------------------------------------------------->
<!-- THE PAGE STARTS HERE                                                -->
<!------------------------------------------------------------------------->
    <div class="wiki-div">
        <div class="markdown-body">
            <embed>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>New-For-Godot-4</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="github-markdown.css" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header id="title-block-header">
<h1 class="title">New-For-Godot-4</h1>
</header>
<h1 id="godot-4-changes">Godot 4 Changes</h1>
<p>These are changes to Godot that affect how GUT is used/implemented.
There is more information about these changes and how GUT has been
altered below.</p>
<ul>
<li><code>setget</code> has been replaced with a completely new syntax.
More info at <a
href="https://github.com/bitwes/Gut/issues/380">#380</a>. Examples of
the new way and the new <code>assert_property</code> method below.</li>
<li><code>connect</code> has been significantly altered. The signal
related asserts will likely change to use <code>Callable</code>
parameters instead of strings. It is possible to use strings, so this
may remain in some form. More info in <a
href="https://github.com/bitwes/Gut/issues/383">#383</a>.</li>
<li><code>yield</code> has been replaced with <code>await</code>.
<code>yield_to</code>, <code>yield_for</code>, and
<code>yield_frames</code> have been deprecated, the new methods are
<code>wait_seconds</code>, <code>wait_frames</code> and
<code>wait_for_signal</code>. There are examples below and more info at
<a href="https://github.com/bitwes/Gut/issues/382">#382</a>.</li>
<li>Arrays are pass by reference now.</li>
<li>Dictionaries are compared by value now.</li>
<li><code>File</code> and <code>Directory</code> have been replaced with
<code>FileAccess</code> and <code>DirAccess</code>.</li>
<li><code>is</code> no longer accepts a variable for a class. You must
use <code>is_instance_of</code> instead.</li>
</ul>
<h1 id="whats-newchanged-in-gut-900-for-godot-40">What's new/changed in
GUT 9.0.0 for Godot 4.0</h1>
<ul>
<li>Any methods that were deprecated in GUT 7.x have been removed.</li>
<li><code>assert_setget</code> no longer works (it now just fails with a
message). <code>assert_property</code> has been altered to work with the
new setter/getter syntax. <code>assert_set_property</code>,
<code>assert_readonly_property</code>, and
<code>assert_property_with_backing_variable</code> have been added.</li>
<li>To aid refactoring, <code>assert_property</code> and
<code>assert_property_with_backing_variable</code> will warn if any
"public accessors" are found for the property ('get_' and 'set_'
methods).</li>
<li><code>assert_property</code> now requires an instance instead of
also working with a loaded objects.</li>
<li>Doubling strategy flags have been renamed to
<code>INCLUDE_NATIVE</code> (was <code>FULL</code>) and
<code>SCRIPT_ONLY</code> (was <code>PARTIAL</code>). The default is
<code>SCRIPT_ONLY</code>. I wanted something more descriptive and less
likely to be confused with partial doubles.</li>
<li>Added support for a <code>skip_script</code> test-script variable.
This can be added to any test-script or inner-class causing GUT to skip
running tests in that script. The script will be included in the "risky"
count and appear in the summary as skipped. This was done to help
porting tests to 4.0 but might stick around as a permanent feature.</li>
</ul>
<div class="sourceCode" id="cb1"><pre
class="sourceCode gdscript"><code class="sourceCode gdscript"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> skip_script <span class="op">=</span> <span class="st">&#39;The reason for skipping.  This will be printed in the output.&#39;</span></span></code></pre></div>
<ul>
<li>The various <code>yield_</code> methods have been deprecated but are
still supported to make conversions easier. The new syntax for
<code>yield_to</code>, <code>yield_for</code>, or
<code>yield_frames</code> is:</li>
</ul>
<div class="sourceCode" id="cb2"><pre
class="sourceCode gdscript"><code class="sourceCode gdscript"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>await <span class="fu">yield_to</span>(signaler, <span class="st">&#39;the_signal_name&#39;</span>, <span class="dv">5</span>, <span class="st">&#39;optional message&#39;</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>await <span class="fu">yield_for</span>(<span class="fl">1.5</span>, <span class="st">&#39;optional message&#39;</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>await <span class="fu">yield_frames</span>(<span class="dv">30</span>, <span class="st">&#39;optional message&#39;</span>)</span></code></pre></div>
<ul>
<li>The replacement methods for the various <code>yield_</code> methods
are <code>wait_seconds</code>, <code>wait_frames</code>, and
<code>wait_for_signal</code>.</li>
</ul>
<div class="sourceCode" id="cb3"><pre
class="sourceCode gdscript"><code class="sourceCode gdscript"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>await <span class="fu">wait_for_signal</span>(signaler.the_signal, <span class="dv">5</span>, <span class="st">&#39;optional message&#39;</span>) <span class="co"># wait for signal or 5 seconds</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>await <span class="fu">wait_seconds</span>(<span class="fl">1.5</span>, <span class="st">&#39;optional message&#39;</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>await <span class="fu">wait_frames</span>(<span class="dv">30</span>, <span class="st">&#39;optional message&#39;</span>)</span></code></pre></div>
<ul>
<li>Doubling no longer supports paths to a script or scene. Load the
script or scene first and pass that to <code>double</code>. See the
"Doubling Changes" section for more details.</li>
<li>Doubling Inner Classes now requires you to call
<code>register_inner_classes</code> first. See the "Doubling Changes"
section for more details.</li>
<li>Comparing Dictionary/Arrays with <code>assert_eq</code>,
<code>assert_eq_deep</code>, and the new <code>assert_same</code> and
<code>assert_not_same</code> for comparing references. See Godot's new
<code>is_same</code> function for details on how
<code>assert_same</code> works (it's just an assertion wrapper around
<code>is_same</code>). See the section "Comparing Dictionaries and
Arrays" below for more details.</li>
</ul>
<h2 id="comparing-dictionaries-and-arrays">Comparing Dictionaries and
Arrays</h2>
<p>In Godot 3.x dictionaries were compared by reference and arrays were
compared by value. In 4.0 both are compared by value. Godot 4.0
introduces the <code>is_same</code> method which (amongst other things)
will compare dictionaries and arrays by reference.</p>
<p>GUT's <code>assert_eq</code> and <code>assert_ne</code> changed to
match Godot's behavior. To compare by reference you can use the new
<code>assert_same</code> or <code>assert_not_same</code>. This works
with arrays and dictionaries. Review Godot's documentation for
<code>is_same</code>. When comparing dictionaries and arrays it is
recommended that you use <code>assert_eq_deep</code> since it provides
more detailed output than <code>assert_eq</code>.</p>
<p>The shallow compare functionality has been removed since it no longer
applies. Shallow compares would compare the elements of an array or
dictionary by value. In Godot 3.x this meant that dictionaries inside of
arrays or dictionaries would be compared by reference and everything
else would be compared by value. Since arrays and dictionaries are both
compared by value now, shallow compares are no different (functionally)
than deep compares. The following methods have been removed. Calling
these methods will generate a failure and an error.</p>
<ul>
<li><code>compare_shallow</code> (causes failure and returns
<code>null</code> which will likely result in a runtime error)</li>
<li><code>assert_eq_shallow</code></li>
<li><code>assert_ne_shallow</code></li>
</ul>
<p>Final note: <code>assert_eq</code> does not use
<code>assert_eq_deep</code> since <code>assert_eq_deep</code> compares
each element of both arrays/dictionaries and provides detailed info
about what is different. This can be slow for large arrays/dictionaries.
Godot's <code>==</code> operator uses a hashing function which is much
faster but does not provide information about what is different in each
array/dictionary. With <code>assert_eq</code>,
<code>assert_eq_deep</code>, and <code>assert_same</code> (and their
inverses) you have fine grained control over the type of comparison that
is performed.</p>
<h2 id="doubling-changes">Doubling Changes</h2>
<h4 id="doubling-scripts-and-scenes">Doubling scripts and scenes</h4>
<p>The <code>double</code> method no longer supports paths to scripts or
scenes. You should <code>load</code> the script or scene first, and then
pass that to <code>double</code> instead.</p>
<pre><code>var MyScript = load(&#39;res://my_script.gd&#39;)
var dbl = double(MyScript).new()</code></pre>
<p>If you pass a string then an error message will be printed and
<code>double</code> will return <code>null</code>. This will most likely
result in a runtime error when you attempt to instantiate your
double.</p>
<pre><code>&#39;Invalid call. Nonexistent function &#39;new&#39; in base &#39;Nil&#39;.&#39;</code></pre>
<h3 id="doubling-inner-classes">Doubling Inner Classes</h3>
<p>The <code>double</code> method no longer supports strings for the
path of the base script or a string of the name of the Inner Class. You
must call <code>register_inner_classes</code> then pass the Inner Class
to <code>double</code>. You only have to do this once, so it is best to
call it in <code>before_all</code> or a pre-hook script. Registering
multiple times does nothing. Failing to call
<code>register_inner_classes</code> will result in a GUT error and a
runtime error.</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode gdscript"><code class="sourceCode gdscript"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Given that SomeScript contains the class InnerClass that you wish to to double:</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> SomeScript <span class="op">=</span> <span class="bu">load</span>(<span class="st">&#39;res://some_script.gd&#39;</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="fu">before_all</span>():</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">register_inner_classes</span>(SomeScript)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="fu">test_foo</span>():</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> dbl <span class="op">=</span> <span class="fu">double</span>(SomeScript.InnerClass).<span class="fu">new</span>()</span></code></pre></div>
<p>This approach was used to make tests cleaner and less susceptible to
typos. If Godot adds meta data to inner classes that point back to the
source script, then <code>register_inner_classes</code> can be removed
later and no other changes will need to be made.</p>
<h2 id="setget-vs-set-and-get">setget vs set: and get:</h2>
<p>In godot 4.0 <code>setget</code> has been replaced with
<code>set(val):</code> and <code>get():</code> pseudo methods which make
properties more concrete. This is a welcome change, but comes with a few
caveats.</p>
<p>Here's an example of usage:</p>
<pre><code>var foo = 10:
    get():
        return foo
    set(val):
        foo = val</code></pre>
<p>This means you no longer need to define methods for your accessors.
Though you may still want to for organizational purposes.</p>
<p>One downside to this approach is that there is no way to set the
<code>foo</code> without going through the accessor. Many times,
internally, you will want to set a value for a property without going
through the setter. This is still possible, but you have to make a
backing variable.</p>
<pre><code>var _foo = 10
var foo = 10:
    get():
        return _foo
    set(val):
        _foo = val
        foo_changed.emit()</code></pre>
<p>With this approach you can set <code>_foo</code> internally in your
class without triggering the <code>foo_changed</code> signal. When you
see <code>foo =</code> anywhere in your code, it will be going through
the accessor. When you see <code>_foo =</code> you are only setting the
backing variable.</p>
<p>To test this new paradigm <code>assert_setget</code> has been
removed. <code>assert_property</code> has changed to work with the new
syntax. <code>assert_property_with_backing_variable</code> was added to
validate the backing variable wiring. If you use
<code>assert_property_with_backing_variable</code> it will verify that
the property has accessors and will also look for a
<code>_&lt;varname&gt;</code> variable with the same name and verify it
is being set.</p>
<p><code>assert_property</code> will generate a warning when it finds
"public" accessors for these properties (<code>get_foo</code>,
<code>set_foo</code>).</p>
<h1 id="implementation-changes">Implementation Changes</h1>
<ul>
<li>The <code>Gut</code> control has been removed. Adding a
<code>Gut</code> node to a scene to run tests will no longer work. This
control dates back to Godot 2.x days. With GUT 7.4.1 I believe the
in-editor Gut Panel has enough features to discontinue using a
Scene/<code>Gut</code> control to run tests. Another approach for
running tests in a deployed project will be added at some point.</li>
<li>The GUI for GUT has been simplified to reflect that it is no longer
used to run tests, just display progress and output. It has also been
decoupled from <code>gut.gd</code>. <code>gut.gd</code> is now a
<code>Node</code> instead of a <code>Control</code> and all GUI logic
has been removed. New signals have been added so that a GUI can be made
without <code>gut.gd</code> having to know anything about it. As a
result, GUT can now be run without a GUI if that ever becomes something
we want to do.</li>
<li>Replaced the old <code>yield_between_tests</code> flag with
<code>paint_after</code>. This property (initially set to .1s) tells GUT
how long to wait before it pauses for 1 frame to allow for painting the
screen. This value is checked after each test, so longer tests can still
cause a delay in the painting of the screen. This has made the painting
a little choppier but has cut down the time it takes to run tests (200
simple tests in 20 scripts dropped from 2+ seconds to .5 seconds to
run). This feature is settable from the command line, .gutconfig.json,
and GutPanel.</li>
<li>Doubling has changed significantly.</li>
</ul>
</body>
</html>

            </embed>
        </div>
    </div>

</body>

</html>