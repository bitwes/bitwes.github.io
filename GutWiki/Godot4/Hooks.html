<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link id="maincss" rel="stylesheet" href="github-markdown.css">
    <link rel="stylesheet" href="exported_wiki.css">
</head>


<body>

<!------------------------------------------------------------------------->
<!-- THE TOC STARTS HERE                                                 -->
<!------------------------------------------------------------------------->

    <div id="toc" class="w3-sidebar w3-border-right">
        <div class="markdown-body">
            <embed>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Gut Wiki</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <link rel="stylesheet" href="github-markdown.css" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header id="title-block-header">
<h1 class="title">Gut Wiki</h1>
</header>
<h3 id="901-godot-4x">9.0.1 (Godot 4.x)</h3>
<h3 id="start-here">Start Here</h3>
<ul>
<li><a href="New-For-Godot-4.html">New-For-Godot-4</a></li>
<li><a href="Home.html">Home</a></li>
<li><a href="Quick-Start.html">Quick-Start</a></li>
</ul>
<h3 id="all-pages">All Pages</h3>
<ul>
<li><a href="Asserts-and-Methods.html">Asserts-and-Methods</a></li>
<li><a href="Command-Line.html">Command-Line</a></li>
<li><a href="Comparing-Things.html">Comparing-Things</a></li>
<li><a href="Contributing.html">Contributing</a></li>
<li><a href="Creating-Tests.html">Creating-Tests</a></li>
<li><a href="Double-Strategy.html">Double-Strategy</a></li>
<li><a href="Doubles.html">Doubles</a></li>
<li><a href="Export-Test-Results.html">Export-Test-Results</a></li>
<li><a href="Home.html">Home</a></li>
<li><a href="Hooks.html">Hooks</a></li>
<li><a href="Inner-Test-Classes.html">Inner-Test-Classes</a></li>
<li><a href="Input-Factory.html">Input-Factory</a></li>
<li><a href="Install.html">Install</a></li>
<li><a href="Memory-Management.html">Memory-Management</a></li>
<li><a href="Mock-Input.html">Mock-Input</a></li>
<li><a href="New-For-Godot-4.html">New-For-Godot-4</a></li>
<li><a href="Orphans.html">Orphans</a></li>
<li><a href="Parameterized-Tests.html">Parameterized-Tests</a></li>
<li><a href="Partial-Doubles.html">Partial-Doubles</a></li>
<li><a href="Quick-Start.html">Quick-Start</a></li>
<li><a href="Running-On-Devices.html">Running-On-Devices</a></li>
<li><a href="Simulate.html">Simulate</a></li>
<li><a href="Spies.html">Spies</a></li>
<li><a href="Stubbing.html">Stubbing</a></li>
<li><a href="Tutorials.html">Tutorials</a></li>
<li><a href="Yielding.html">Yielding</a></li>
</ul>
</body>
</html>

            </embed>
        </div>
    </div>


<!------------------------------------------------------------------------->
<!-- THE PAGE STARTS HERE                                                -->
<!------------------------------------------------------------------------->
    <div class="wiki-div">
        <div class="markdown-body">
            <embed>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Hooks</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <link rel="stylesheet" href="github-markdown.css" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header id="title-block-header">
<h1 class="title">Hooks</h1>
</header>
<h1
id="this-page-has-not-been-updated-for-gut-900-or-godot-4-there-could-be-incorrect-information-here"><div class="warning">This
page has not been updated for GUT 9.0.0 or Godot 4. There could be
incorrect information here.</div></h1>
<h1 id="overview">Overview</h1>
<p>Pre-run and post-run hooks allow you to take any initialization steps
or verify the results of the run.</p>
<p>Hook scripts can be set through the editor, through a command line
option or in the <code>.gutconfig.json</code> file.</p>
<p>All Hook scripts must inherit from <a
href="https://github.com/bitwes/Gut/blob/master/addons/gut/hook_script.gd"><code>GutHookScript</code></a>.
If the pre-run or post-run scripts specified do not exist or do not
extend <code>GutHookScript</code> then the run will be aborted before
any tests are run.</p>
<p>All Hook scripts have access to the GUT instance that is running the
tests via the <code>gut</code> property defined in
<code>hook_script.gd</code>. This is set after initializing the
script.</p>
<p>GUT executes the <code>run()</code> method in each of the Hook
scripts. Place your custom code in there.</p>
<p><strong>Note:</strong> All Hook scripts are instantiated at the start
of the run and later <code>run()</code> is called on each instance at
the appropriate time. The <code>_init()</code> method of your Hook
Script will not have access to the GUT instance since it is set
later.</p>
<h1 id="setup">Setup</h1>
<p>Create scripts that inherit from <code>GutHookScript</code>,
implement the <code>run()</code> method, and set their paths either
through the editor, command line or <code>.gutconfig.json</code>.</p>
<h4 id="editor">Editor</h4>
<p>The GUT node has <code>pre_run_script</code> and
<code>post_run_script</code> properties to set the path to your Hook
scripts.</p>
<h4 id="command-line">Command Line</h4>
<p>The command line <code>-gpre_run_script</code> and
<code>-gpost_run_script</code> options. You can also specify
<code>pre_run_script</code> and <code>post_run_script</code> in the
<code>.gutconfig.json</code> file.</p>
<h1 id="features">Features</h1>
<p>The following features are available to scripts that inherit from
<code>GutHookScript</code>. Not all features are usable by all hooks.
Details below.</p>
<ul>
<li><code>gut</code> - the GUT instance running tests.</li>
<li><code>abort()</code> - abort the test run.</li>
<li><code>set_exit_code(code)</code> - Set the code to be returned when
the command line finishes.</li>
<li>The <code>JunitXmlExport</code> class can be used to create an
export object to export results. See <a
href="Export-Test-Results.html">Export-Test-Results</a></li>
</ul>
<h3 id="access-gut-instance">Access GUT instance</h3>
<p>Each Hook script can access the GUT instance via the <code>gut</code>
variable. Useful for getting to summary info or manipulating the GUT
instance for reasons I can't think of (which is probably a bad idea but
who am I to judge).</p>
<h3 id="abort-pre-run-only">Abort (pre-run only)</h3>
<p>The built in <code>abort()</code> method will cause the run to end
immediately after the <code>run()</code> method of the pre-run script
finishes. The post-run script will NOT be executed. Calling this in the
post-run script will have no effect.</p>
<h3 id="exit-code-post-run-only">Exit Code (post-run only)</h3>
<p>The <code>set_exit_code(code)</code> method will set an exit code
that will be used when running from the command line. The default
behavior is to return <code>0</code> when all tests pass and
<code>1</code> if any tests fail (pending tests do not affect the exit
code). If you call <code>set_exit_code</code> then the value passed will
be used.</p>
<p><strong>Note</strong> Any call directly to <code>OS.exit_code</code>
will be overwritten by <code>gut_cmdln</code>.</p>
<p><strong>Note</strong> Calling <code>set_exit_code</code> in the
pre-run script will not affect the actual exit code. You could use
<code>gut.get_pre_run_script_instance().get_exit_code()</code> in your
post-run script to get you any value you've set via
<code>set_exit_code</code> in your pre-run script.</p>
<h1 id="-pre-run-hook"><a name="prerun"> Pre-Run Hook</h1>
<p>The pre-run hook is run just before any tests are executed. This can
be useful in setting global variables or performing any setup required
for all your tests.</p>
<p>The post-run hook can access the pre-run hook instance via
<code>gut.get_pre_run_script_instance()</code>.</p>
<p><strong>Things to do in your pre-run script</strong>:</p>
<ul>
<li>mute all sounds
<code>AudioServer.set_bus_volume_db(0, -INF)</code></li>
<li>set flags you've implemented to prevent actions from occurring
during tests
<ul>
<li>flags to prevent files from being saved like user stats (my personal
catalyst for all these features)</li>
<li>logging levels for your application</li>
</ul></li>
<li>other things I haven't thought of.</li>
</ul>
<h1 id="post-run-hook"><a name="postrun">Post-Run Hook</h1>
<p>The post-run hook is run after all tests are run and all output has
been generated. The post-run hook can access the pre-run script instance
(if one was specified) via
<code>gut.get_pre_run_script_instance()</code>.</p>
<p>The post-run hook could be useful in writing files used by CICD
pipelines to verify the status fo the run.</p>
<h1 id="summary-info">Summary Info</h1>
<p>GUT tracks the results of all the scripts and tests that are run.
There is a Summary object that you can access via the <code>gut</code>
variable. Using this information you can take actions in the post-run
hook.</p>
<p>Reading the documentation/code in <a
href="https://github.com/bitwes/Gut/blob/master/addons/gut/summary.gd">summary.gd</a>
will get you the full details, but here are a few examples of how to get
the summary data.</p>
<h3 id="full-summary">Full Summary</h3>
<pre><code># Returns GUT&#39;s summary.gd instance holding all the data about the run.
gut.get_summary()</code></pre>
<h3 id="counts">Counts</h3>
<pre><code># This will return a dictionary containing the following counts:
#   passing = 0,
#   pending = 0,
#   failing = 0,
#   tests = 0,
#   scripts = 0
gut.get_summary().get_totals()</code></pre>
<h3 id="all-scripts">All Scripts</h3>
<pre><code># Returns and array of Summary.gd.TestScript objects that have detailed information
# about each script/inner class that was ran.  See summary.gd for more details.
gut.get_summary().get_scripts()</code></pre>
</body>
</html>

            </embed>
        </div>
    </div>

</body>

</html>