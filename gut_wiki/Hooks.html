
        <html><head>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <style>
            .markdown-body {
                box-sizing: border-box;
                min-width: 200px;
                max-width: 980px;
                margin: 0 auto;
                padding: 45px;
            }

            @media (max-width: 767px) {
                .markdown-body {
                    padding: 15px;
                }
            }
        </style>
        <link rel="stylesheet" href="github-markdown.css"/>
</head><body><article class="markdown-body"><h1><a id="user-content-hooks" class="anchor" aria-hidden="true" href="#hooks"><span aria-hidden="true" class="octicon octicon-link"></span></a>Hooks</h1>
<h1><a id="user-content-overview" class="anchor" aria-hidden="true" href="#overview"><span aria-hidden="true" class="octicon octicon-link"></span></a>Overview</h1>
<p>Pre-run and post-run hooks allow you to take any initialization steps or verify the results of the run.</p>
<p>Hook scripts can be set through the editor, through a command line option or in the <code>.gutconfig.json</code> file.</p>
<p>All Hook scripts must inherit from <a href="https://github.com/bitwes/Gut/blob/master/addons/gut/hook_script.gd"><code>GutHookScript</code></a>.  If the pre-run or post-run scripts specified do not exist or do not extend <code>GutHookScript</code> then the run will be aborted before any tests are run.</p>
<p>All Hook scripts have access to the GUT instance that is running the tests via the <code>gut</code> property defined in <code>hook_script.gd</code>.  This is set after initializing the script.</p>
<p>GUT executes the <code>run()</code> method in  each of the Hook scripts.  Place your  custom code in there.</p>
<p><strong>Note:</strong> All Hook scripts are instantiated at the start of the run and later <code>run()</code> is called on each instance at the appropriate time.  The <code>_init()</code> method of your Hook Script will not have access to the GUT instance since it is set  later.</p>
<h1><a id="user-content-setup" class="anchor" aria-hidden="true" href="#setup"><span aria-hidden="true" class="octicon octicon-link"></span></a>Setup</h1>
<p>Create scripts that inherit from <code>GutHookScript</code>, implement the <code>run()</code> method, and set their paths either through the editor, command line or  <code>.gutconfig.json</code>.</p>
<h4><a id="user-content-editor" class="anchor" aria-hidden="true" href="#editor"><span aria-hidden="true" class="octicon octicon-link"></span></a>Editor</h4>
<p>The GUT node has <code>pre_run_script</code> and <code>post_run_script</code> properties to set the path to your Hook scripts.</p>
<h4><a id="user-content-command-line" class="anchor" aria-hidden="true" href="#command-line"><span aria-hidden="true" class="octicon octicon-link"></span></a>Command Line</h4>
<p>The command line <code>-gpre_run_script</code> and <code>-gpost_run_script</code> options.  You can also specify <code>pre_run_script</code> and <code>post_run_script</code> in the <code>.gutconfig.json</code> file.</p>
<h1><a id="user-content-features" class="anchor" aria-hidden="true" href="#features"><span aria-hidden="true" class="octicon octicon-link"></span></a>Features</h1>
<p>The following features are available to scripts that inherit from <code>GutHookScript</code>.  Not all features are usable by all hooks.  Details below.</p>
<ul>
<li>
<code>gut</code> - the GUT instance running tests.</li>
<li>
<code>abort()</code> - abort the test run.</li>
<li>
<code>set_exit_code(code)</code> - Set the code to be returned when the command line finishes.</li>
<li>The <code>JunitXmlExport</code> class can be used to create an export object to export results.  See <a href="Export-Test-Results.html">Export-Test-Results</a>
</li>
</ul>
<h3><a id="user-content-access-gut-instance" class="anchor" aria-hidden="true" href="#access-gut-instance"><span aria-hidden="true" class="octicon octicon-link"></span></a>Access GUT instance</h3>
<p>Each Hook script can access the GUT instance via the <code>gut</code> variable.  Useful for getting to summary info or manipulating the GUT instance for reasons I can't think of (which is probably a bad idea but who am I to judge).</p>
<h3><a id="user-content-abort-pre-run-only" class="anchor" aria-hidden="true" href="#abort-pre-run-only"><span aria-hidden="true" class="octicon octicon-link"></span></a>Abort (pre-run only)</h3>
<p>The built in <code>abort()</code> method will cause the run to end immediately after the <code>run()</code> method of the pre-run script finishes.  The post-run script will NOT be executed.  Calling this in the post-run script will have no effect.</p>
<h3><a id="user-content-exit-code-post-run-only" class="anchor" aria-hidden="true" href="#exit-code-post-run-only"><span aria-hidden="true" class="octicon octicon-link"></span></a>Exit Code (post-run only)</h3>
<p>The <code>set_exit_code(code)</code> method will set an exit code that will be used when running from the command line.  The default behavior is to return <code>0</code> when all tests pass and <code>1</code> if any  tests fail (pending tests do not affect the exit code).  If you call <code>set_exit_code</code> then the value passed will be used.</p>
<p><strong>Note</strong> Any call directly to <code>OS.exit_code</code> will be overwritten by <code>gut_cmdln</code>.</p>
<p><strong>Note</strong> Calling <code>set_exit_code</code> in the pre-run script will not affect the actual exit code.  You could use <code>gut.get_pre_run_script_instance().get_exit_code()</code> in your post-run script to get you any value you've set via <code>set_exit_code</code> in your pre-run script.</p>
<h1><a id="user-content--pre-run-hook" class="anchor" aria-hidden="true" href="#-pre-run-hook"><span aria-hidden="true" class="octicon octicon-link"></span></a><a name="user-content-prerun"> Pre-Run Hook</a></h1>
<p>The pre-run hook is run just before any tests are executed.  This can be useful in setting global variables or performing any setup required for all your tests.</p>
<p>The post-run hook can access the pre-run hook instance via <code>gut.get_pre_run_script_instance()</code>.</p>
<p><strong>Things to do in your pre-run script</strong>:</p>
<ul>
<li>mute all sounds <code>AudioServer.set_bus_volume_db(0, -INF)</code>
</li>
<li>set flags you've implemented to prevent actions from occurring during tests
<ul>
<li>flags to prevent files from being saved like user stats (my personal catalyst for all these features)</li>
<li>logging levels for your application</li>
</ul>
</li>
<li>other things I haven't thought of.</li>
</ul>
<h1><a id="user-content-post-run-hook" class="anchor" aria-hidden="true" href="#post-run-hook"><span aria-hidden="true" class="octicon octicon-link"></span></a><a name="user-content-postrun">Post-Run Hook</a></h1>
<p>The post-run hook is run after all tests are run and all output has been generated.  The post-run hook can access the pre-run script instance (if one was specified) via <code>gut.get_pre_run_script_instance()</code>.</p>
<p>The post-run hook could be useful in writing files used by CICD pipelines to verify the status fo the run.</p>
<h1><a id="user-content-summary-info" class="anchor" aria-hidden="true" href="#summary-info"><span aria-hidden="true" class="octicon octicon-link"></span></a>Summary Info</h1>
<p>GUT tracks the results of all the scripts and tests that are run.  There is a Summary object that you can access via the <code>gut</code> variable.  Using this information you can take actions in the post-run hook.</p>
<p>Reading the documentation/code in <a href="https://github.com/bitwes/Gut/blob/master/addons/gut/summary.gd">summary.gd</a> will get you the full details, but here are a few examples of how to get the summary data.</p>
<h3><a id="user-content-full-summary" class="anchor" aria-hidden="true" href="#full-summary"><span aria-hidden="true" class="octicon octicon-link"></span></a>Full Summary</h3>
<pre><code># Returns GUT's summary.gd instance holding all the data about the run.
gut.get_summary()
</code></pre>
<h3><a id="user-content-counts" class="anchor" aria-hidden="true" href="#counts"><span aria-hidden="true" class="octicon octicon-link"></span></a>Counts</h3>
<pre><code># This will return a dictionary containing the following counts:
#   passing = 0,
#   pending = 0,
#   failing = 0,
#   tests = 0,
#   scripts = 0
gut.get_summary().get_totals()
</code></pre>
<h3><a id="user-content-all-scripts" class="anchor" aria-hidden="true" href="#all-scripts"><span aria-hidden="true" class="octicon octicon-link"></span></a>All Scripts</h3>
<pre><code># Returns and array of Summary.gd.TestScript objects that have detailed information
# about each script/inner class that was ran.  See summary.gd for more details.
gut.get_summary().get_scripts()
</code></pre>
</article></body>