
        <html><head>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <style>
            .markdown-body {
                box-sizing: border-box;
                min-width: 200px;
                max-width: 980px;
                margin: 0 auto;
                padding: 45px;
            }

            @media (max-width: 767px) {
                .markdown-body {
                    padding: 15px;
                }
            }
        </style>
        <link rel="stylesheet" href="github-markdown.css"/>
</head><body><article class="markdown-body"><h1><a id="user-content-simulate" class="anchor" aria-hidden="true" href="#simulate"><span aria-hidden="true" class="octicon octicon-link"></span></a>Simulate</h1>
<h2><a id="user-content--simulate" class="anchor" aria-hidden="true" href="#-simulate"><span aria-hidden="true" class="octicon octicon-link"></span></a><a name="user-content-simulate"> Simulate</a></h2>
<p>The simulate method will call the <code>_process</code> and <code>_physics_process</code> on a tree of objects.  It will check each object to see if they have either method and run it if it exists.  In cases where the object has both it will call <code>_process</code> and then <code>_physics_process</code> and then move on to the next node in the tree.</p>
<p><code>simulate</code> takes in the base object, the number of times to call the methods and the delta value to be passed to <code>_process</code> or <code>_physics_process</code> (if the object has one).  It starts calling it on the passed in object and then moves through the tree recursively calling <code>_process</code> and <code>_physics_process</code>.  The order that the children are processed is determined by the order that <code>get_children</code> returns</p>
<p><code>simulate</code> will only cause code directly related to the <code>_process</code> and <code>_physics_process</code> methods to run.  Signals will be sent, methods will be called but timers, for example, will not fire since the main loop of the game is not actually running.  Creating a test that <code>yield</code>s is a better solution for testing such things.</p>
<p>Example</p>
<div class="highlight highlight-source-gdscript"><pre><span class="pl-c"><span class="pl-c">#</span> --------------------------------</span>
<span class="pl-c"><span class="pl-c">#</span> res://scripts/my_object.gd</span>
<span class="pl-c"><span class="pl-c">#</span> --------------------------------</span>
<span class="pl-k">extends</span><span class="pl-e"> Node2D</span>
  <span class="pl-k">var</span> a_number <span class="pl-k">=</span> <span class="pl-c1">1</span>

  <span class="pl-k">func</span> <span class="pl-en">_process</span>(<span class="pl-smi">delta</span>):
    a_number <span class="pl-k">+=</span> <span class="pl-c1">1</span>

<span class="pl-c"><span class="pl-c">#</span> --------------------------------</span>
<span class="pl-c"><span class="pl-c">#</span> res://scripts/another_object.gd</span>
<span class="pl-c"><span class="pl-c">#</span> --------------------------------</span>
<span class="pl-k">extends</span><span class="pl-e"> Node2D</span>
  <span class="pl-k">var</span> another_number <span class="pl-k">=</span> <span class="pl-c1">1</span>

  <span class="pl-k">func</span> <span class="pl-en">_physics_process</span>(<span class="pl-smi">delta</span>):
    another_number <span class="pl-k">+=</span> <span class="pl-c1">1</span>

<span class="pl-c"><span class="pl-c">#</span> --------------------------------</span>
<span class="pl-c"><span class="pl-c">#</span> res://test/unit/test_my_object.gd</span>
<span class="pl-c"><span class="pl-c">#</span> --------------------------------</span>

<span class="pl-c"><span class="pl-c">#</span> ...</span>

<span class="pl-k">var</span> <span class="pl-c1">MyObject</span> <span class="pl-k">=</span> <span class="pl-c1">load</span>(<span class="pl-s">'res://scripts/my_object.gd'</span>)
<span class="pl-k">var</span> <span class="pl-c1">AnotherObject</span> <span class="pl-k">=</span> <span class="pl-c1">load</span>(<span class="pl-s">'res://scripts/another_object'</span>)

<span class="pl-c"><span class="pl-c">#</span> ...</span>

<span class="pl-c"><span class="pl-c">#</span> Given that SomeCoolObj has a _process method that incrments a_number by 1</span>
<span class="pl-c"><span class="pl-c">#</span> each time _process is called, and that the number starts at 0, this test</span>
<span class="pl-c"><span class="pl-c">#</span> should pass</span>
<span class="pl-k">func</span> <span class="pl-en">test_does_something_each_loop</span>():
  <span class="pl-k">var</span> my_obj <span class="pl-k">=</span> <span class="pl-c1">MyObject</span>.<span class="pl-c1">new</span>()
  <span class="pl-c1">add_child_autofree</span>(my_obj)
  gut.<span class="pl-c1">simulate</span>(my_obj, <span class="pl-c1">20</span>, .<span class="pl-c1">1</span>)
  <span class="pl-c1">assert_eq</span>(my_obj.a_number, <span class="pl-c1">20</span>, <span class="pl-s">'Since a_number is incremented in _process, it should be 20 now'</span>)

<span class="pl-c"><span class="pl-c">#</span> Let us also assume that AnotherObj acts exactly the same way as</span>
<span class="pl-c"><span class="pl-c">#</span> but has SomeCoolObj but has a _physics_process method instead of</span>
<span class="pl-c"><span class="pl-c">#</span> _process.  In that case, this test will pass too since all child objects</span>
<span class="pl-c"><span class="pl-c">#</span> have the _process or _physics_process method called.</span>
<span class="pl-k">func</span> <span class="pl-en">test_does_something_each_loop</span>():
  <span class="pl-k">var</span> my_obj <span class="pl-k">=</span> <span class="pl-c1">MyObject</span>.<span class="pl-c1">new</span>()
  <span class="pl-k">var</span> other_obj <span class="pl-k">=</span> <span class="pl-c1">AnotherObj</span>.<span class="pl-c1">new</span>()

  <span class="pl-c1">add_child_autofree</span>(my_obj)
  my_obj.<span class="pl-c1">add_child</span>(other_obj)

  gut.<span class="pl-c1">simulate</span>(my_obj, <span class="pl-c1">20</span>, .<span class="pl-c1">1</span>)

  <span class="pl-c1">assert_eq</span>(my_obj.a_number, <span class="pl-c1">20</span>, <span class="pl-s">'Since a_number is incremented in _process, \</span>
<span class="pl-s">                                  it should be 20 now'</span>)
  <span class="pl-c1">assert_eq</span>(other_obj.another_number, <span class="pl-c1">20</span>, <span class="pl-s">'Since other_obj is a child of my_obj \</span>
<span class="pl-s">                                           and another_number is incremented in \</span>
<span class="pl-s">                                           _physics_process then it should be 20 now'</span>)
</pre></div>
<h1><a id="user-content-where-to-next" class="anchor" aria-hidden="true" href="#where-to-next"><span aria-hidden="true" class="octicon octicon-link"></span></a>Where to next?</h1>
<ul>
<li>
<a href="https://github.com/bitwes/Gut/wiki/Yielding">Yielding</a><br>
</li>
</ul>
</article></body>