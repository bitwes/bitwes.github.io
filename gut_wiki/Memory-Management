
        <html><head>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <style>
            .markdown-body {
                box-sizing: border-box;
                min-width: 200px;
                max-width: 980px;
                margin: 0 auto;
                padding: 45px;
            }

            @media (max-width: 767px) {
                .markdown-body {
                    padding: 15px;
                }
            }

        


.markdown-body .octicon {
    display: inline-block;
    fill: currentColor;
    vertical-align: text-bottom;
  }

  .markdown-body .anchor {
    float: left;
    line-height: 1;
    margin-left: -20px;
    padding-right: 4px;
  }

  .markdown-body .anchor:focus {
    outline: none;
  }

  .markdown-body h1 .octicon-link,
  .markdown-body h2 .octicon-link,
  .markdown-body h3 .octicon-link,
  .markdown-body h4 .octicon-link,
  .markdown-body h5 .octicon-link,
  .markdown-body h6 .octicon-link {
    color: #1b1f23;
    vertical-align: middle;
    visibility: hidden;
  }

  .markdown-body h1:hover .anchor,
  .markdown-body h2:hover .anchor,
  .markdown-body h3:hover .anchor,
  .markdown-body h4:hover .anchor,
  .markdown-body h5:hover .anchor,
  .markdown-body h6:hover .anchor {
    text-decoration: none;
  }

  .markdown-body h1:hover .anchor .octicon-link,
  .markdown-body h2:hover .anchor .octicon-link,
  .markdown-body h3:hover .anchor .octicon-link,
  .markdown-body h4:hover .anchor .octicon-link,
  .markdown-body h5:hover .anchor .octicon-link,
  .markdown-body h6:hover .anchor .octicon-link {
    visibility: visible;
  }

  .markdown-body h1:hover .anchor .octicon-link:before,
  .markdown-body h2:hover .anchor .octicon-link:before,
  .markdown-body h3:hover .anchor .octicon-link:before,
  .markdown-body h4:hover .anchor .octicon-link:before,
  .markdown-body h5:hover .anchor .octicon-link:before,
  .markdown-body h6:hover .anchor .octicon-link:before {
    width: 16px;
    height: 16px;
    content: ' ';
    display: inline-block;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' version='1.1' width='16' height='16' aria-hidden='true'%3E%3Cpath fill-rule='evenodd' d='M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z'%3E%3C/path%3E%3C/svg%3E");
  }.markdown-body {
    -ms-text-size-adjust: 100%;
    -webkit-text-size-adjust: 100%;
    line-height: 1.5;
    color: #24292e;
    font-family: -apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji;
    font-size: 16px;
    line-height: 1.5;
    word-wrap: break-word;
  }

  .markdown-body details {
    display: block;
  }

  .markdown-body summary {
    display: list-item;
  }

  .markdown-body a {
    background-color: initial;
  }

  .markdown-body a:active,
  .markdown-body a:hover {
    outline-width: 0;
  }

  .markdown-body strong {
    font-weight: inherit;
    font-weight: bolder;
  }

  .markdown-body h1 {
    font-size: 2em;
    margin: .67em 0;
  }

  .markdown-body img {
    border-style: none;
  }

  .markdown-body code,
  .markdown-body kbd,
  .markdown-body pre {
    font-family: monospace,monospace;
    font-size: 1em;
  }

  .markdown-body hr {
    box-sizing: initial;
    height: 0;
    overflow: visible;
  }

  .markdown-body input {
    font: inherit;
    margin: 0;
  }

  .markdown-body input {
    overflow: visible;
  }

  .markdown-body [type=checkbox] {
    box-sizing: border-box;
    padding: 0;
  }

  .markdown-body * {
    box-sizing: border-box;
  }

  .markdown-body input {
    font-family: inherit;
    font-size: inherit;
    line-height: inherit;
  }

  .markdown-body a {
    color: #0366d6;
    text-decoration: none;
  }

  .markdown-body a:hover {
    text-decoration: underline;
  }

  .markdown-body strong {
    font-weight: 600;
  }

  .markdown-body hr {
    height: 0;
    margin: 15px 0;
    overflow: hidden;
    background: transparent;
    border: 0;
    border-bottom: 1px solid #dfe2e5;
  }

  .markdown-body hr:after,
  .markdown-body hr:before {
    display: table;
    content: "";
  }

  .markdown-body hr:after {
    clear: both;
  }

  .markdown-body table {
    border-spacing: 0;
    border-collapse: collapse;
  }

  .markdown-body td,
  .markdown-body th {
    padding: 0;
  }

  .markdown-body details summary {
    cursor: pointer;
  }

  .markdown-body kbd {
    display: inline-block;
    padding: 3px 5px;
    font: 11px SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;
    line-height: 10px;
    color: #444d56;
    vertical-align: middle;
    background-color: #fafbfc;
    border: 1px solid #d1d5da;
    border-radius: 3px;
    box-shadow: inset 0 -1px 0 #d1d5da;
  }

  .markdown-body h1,
  .markdown-body h2,
  .markdown-body h3,
  .markdown-body h4,
  .markdown-body h5,
  .markdown-body h6 {
    margin-top: 0;
    margin-bottom: 0;
  }

  .markdown-body h1 {
    font-size: 32px;
  }

  .markdown-body h1,
  .markdown-body h2 {
    font-weight: 600;
  }

  .markdown-body h2 {
    font-size: 24px;
  }

  .markdown-body h3 {
    font-size: 20px;
  }

  .markdown-body h3,
  .markdown-body h4 {
    font-weight: 600;
  }

  .markdown-body h4 {
    font-size: 16px;
  }

  .markdown-body h5 {
    font-size: 14px;
  }

  .markdown-body h5,
  .markdown-body h6 {
    font-weight: 600;
  }

  .markdown-body h6 {
    font-size: 12px;
  }

  .markdown-body p {
    margin-top: 0;
    margin-bottom: 10px;
  }

  .markdown-body blockquote {
    margin: 0;
  }

  .markdown-body ol,
  .markdown-body ul {
    padding-left: 0;
    margin-top: 0;
    margin-bottom: 0;
  }

  .markdown-body ol ol,
  .markdown-body ul ol {
    list-style-type: lower-roman;
  }

  .markdown-body ol ol ol,
  .markdown-body ol ul ol,
  .markdown-body ul ol ol,
  .markdown-body ul ul ol {
    list-style-type: lower-alpha;
  }

  .markdown-body dd {
    margin-left: 0;
  }

  .markdown-body code,
  .markdown-body pre {
    font-family: SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;
    font-size: 12px;
  }

  .markdown-body pre {
    margin-top: 0;
    margin-bottom: 0;
  }

  .markdown-body input::-webkit-inner-spin-button,
  .markdown-body input::-webkit-outer-spin-button {
    margin: 0;
    -webkit-appearance: none;
    appearance: none;
  }

  .markdown-body :checked+.radio-label {
    position: relative;
    z-index: 1;
    border-color: #0366d6;
  }

  .markdown-body .border {
    border: 1px solid #e1e4e8!important;
  }

  .markdown-body .border-0 {
    border: 0!important;
  }

  .markdown-body .border-bottom {
    border-bottom: 1px solid #e1e4e8!important;
  }

  .markdown-body .rounded-1 {
    border-radius: 3px!important;
  }

  .markdown-body .bg-white {
    background-color: #fff!important;
  }

  .markdown-body .bg-gray-light {
    background-color: #fafbfc!important;
  }

  .markdown-body .text-gray-light {
    color: #6a737d!important;
  }

  .markdown-body .mb-0 {
    margin-bottom: 0!important;
  }

  .markdown-body .my-2 {
    margin-top: 8px!important;
    margin-bottom: 8px!important;
  }

  .markdown-body .pl-0 {
    padding-left: 0!important;
  }

  .markdown-body .py-0 {
    padding-top: 0!important;
    padding-bottom: 0!important;
  }

  .markdown-body .pl-1 {
    padding-left: 4px!important;
  }

  .markdown-body .pl-2 {
    padding-left: 8px!important;
  }

  .markdown-body .py-2 {
    padding-top: 8px!important;
    padding-bottom: 8px!important;
  }

  .markdown-body .pl-3,
  .markdown-body .px-3 {
    padding-left: 16px!important;
  }

  .markdown-body .px-3 {
    padding-right: 16px!important;
  }

  .markdown-body .pl-4 {
    padding-left: 24px!important;
  }

  .markdown-body .pl-5 {
    padding-left: 32px!important;
  }

  .markdown-body .pl-6 {
    padding-left: 40px!important;
  }

  .markdown-body .f6 {
    font-size: 12px!important;
  }

  .markdown-body .lh-condensed {
    line-height: 1.25!important;
  }

  .markdown-body .text-bold {
    font-weight: 600!important;
  }

  .markdown-body .pl-c {
    color: #6a737d;
  }

  .markdown-body .pl-c1,
  .markdown-body .pl-s .pl-v {
    color: #005cc5;
  }

  .markdown-body .pl-e,
  .markdown-body .pl-en {
    color: #6f42c1;
  }

  .markdown-body .pl-s .pl-s1,
  .markdown-body .pl-smi {
    color: #24292e;
  }

  .markdown-body .pl-ent {
    color: #22863a;
  }

  .markdown-body .pl-k {
    color: #d73a49;
  }

  .markdown-body .pl-pds,
  .markdown-body .pl-s,
  .markdown-body .pl-s .pl-pse .pl-s1,
  .markdown-body .pl-sr,
  .markdown-body .pl-sr .pl-cce,
  .markdown-body .pl-sr .pl-sra,
  .markdown-body .pl-sr .pl-sre {
    color: #032f62;
  }

  .markdown-body .pl-smw,
  .markdown-body .pl-v {
    color: #e36209;
  }

  .markdown-body .pl-bu {
    color: #b31d28;
  }

  .markdown-body .pl-ii {
    color: #fafbfc;
    background-color: #b31d28;
  }

  .markdown-body .pl-c2 {
    color: #fafbfc;
    background-color: #d73a49;
  }

  .markdown-body .pl-c2:before {
    content: "^M";
  }

  .markdown-body .pl-sr .pl-cce {
    font-weight: 700;
    color: #22863a;
  }

  .markdown-body .pl-ml {
    color: #735c0f;
  }

  .markdown-body .pl-mh,
  .markdown-body .pl-mh .pl-en,
  .markdown-body .pl-ms {
    font-weight: 700;
    color: #005cc5;
  }

  .markdown-body .pl-mi {
    font-style: italic;
    color: #24292e;
  }

  .markdown-body .pl-mb {
    font-weight: 700;
    color: #24292e;
  }

  .markdown-body .pl-md {
    color: #b31d28;
    background-color: #ffeef0;
  }

  .markdown-body .pl-mi1 {
    color: #22863a;
    background-color: #f0fff4;
  }

  .markdown-body .pl-mc {
    color: #e36209;
    background-color: #ffebda;
  }

  .markdown-body .pl-mi2 {
    color: #f6f8fa;
    background-color: #005cc5;
  }

  .markdown-body .pl-mdr {
    font-weight: 700;
    color: #6f42c1;
  }

  .markdown-body .pl-ba {
    color: #586069;
  }

  .markdown-body .pl-sg {
    color: #959da5;
  }

  .markdown-body .pl-corl {
    text-decoration: underline;
    color: #032f62;
  }

  .markdown-body .mb-0 {
    margin-bottom: 0!important;
  }

  .markdown-body .my-2 {
    margin-bottom: 8px!important;
  }

  .markdown-body .my-2 {
    margin-top: 8px!important;
  }

  .markdown-body .pl-0 {
    padding-left: 0!important;
  }

  .markdown-body .py-0 {
    padding-top: 0!important;
    padding-bottom: 0!important;
  }

  .markdown-body .pl-1 {
    padding-left: 4px!important;
  }

  .markdown-body .pl-2 {
    padding-left: 8px!important;
  }

  .markdown-body .py-2 {
    padding-top: 8px!important;
    padding-bottom: 8px!important;
  }

  .markdown-body .pl-3 {
    padding-left: 16px!important;
  }

  .markdown-body .pl-4 {
    padding-left: 24px!important;
  }

  .markdown-body .pl-5 {
    padding-left: 32px!important;
  }

  .markdown-body .pl-6 {
    padding-left: 40px!important;
  }

  .markdown-body .pl-7 {
    padding-left: 48px!important;
  }

  .markdown-body .pl-8 {
    padding-left: 64px!important;
  }

  .markdown-body .pl-9 {
    padding-left: 80px!important;
  }

  .markdown-body .pl-10 {
    padding-left: 96px!important;
  }

  .markdown-body .pl-11 {
    padding-left: 112px!important;
  }

  .markdown-body .pl-12 {
    padding-left: 128px!important;
  }

  .markdown-body hr {
    border-bottom-color: #eee;
  }

  .markdown-body kbd {
    display: inline-block;
    padding: 3px 5px;
    font: 11px SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;
    line-height: 10px;
    color: #444d56;
    vertical-align: middle;
    background-color: #fafbfc;
    border: 1px solid #d1d5da;
    border-radius: 3px;
    box-shadow: inset 0 -1px 0 #d1d5da;
  }

  .markdown-body:after,
  .markdown-body:before {
    display: table;
    content: "";
  }

  .markdown-body:after {
    clear: both;
  }

  .markdown-body>:first-child {
    margin-top: 0!important;
  }

  .markdown-body>:last-child {
    margin-bottom: 0!important;
  }

  .markdown-body a:not([href]) {
    color: inherit;
    text-decoration: none;
  }

  .markdown-body blockquote,
  .markdown-body details,
  .markdown-body dl,
  .markdown-body ol,
  .markdown-body p,
  .markdown-body pre,
  .markdown-body table,
  .markdown-body ul {
    margin-top: 0;
    margin-bottom: 16px;
  }

  .markdown-body hr {
    height: .25em;
    padding: 0;
    margin: 24px 0;
    background-color: #e1e4e8;
    border: 0;
  }

  .markdown-body blockquote {
    padding: 0 1em;
    color: #6a737d;
    border-left: .25em solid #dfe2e5;
  }

  .markdown-body blockquote>:first-child {
    margin-top: 0;
  }

  .markdown-body blockquote>:last-child {
    margin-bottom: 0;
  }

  .markdown-body h1,
  .markdown-body h2,
  .markdown-body h3,
  .markdown-body h4,
  .markdown-body h5,
  .markdown-body h6 {
    margin-top: 24px;
    margin-bottom: 16px;
    font-weight: 600;
    line-height: 1.25;
  }

  .markdown-body h1 {
    font-size: 2em;
  }

  .markdown-body h1,
  .markdown-body h2 {
    padding-bottom: .3em;
    border-bottom: 1px solid #eaecef;
  }

  .markdown-body h2 {
    font-size: 1.5em;
  }

  .markdown-body h3 {
    font-size: 1.25em;
  }

  .markdown-body h4 {
    font-size: 1em;
  }

  .markdown-body h5 {
    font-size: .875em;
  }

  .markdown-body h6 {
    font-size: .85em;
    color: #6a737d;
  }

  .markdown-body ol,
  .markdown-body ul {
    padding-left: 2em;
  }

  .markdown-body ol ol,
  .markdown-body ol ul,
  .markdown-body ul ol,
  .markdown-body ul ul {
    margin-top: 0;
    margin-bottom: 0;
  }

  .markdown-body li {
    word-wrap: break-all;
  }

  .markdown-body li>p {
    margin-top: 16px;
  }

  .markdown-body li+li {
    margin-top: .25em;
  }

  .markdown-body dl {
    padding: 0;
  }

  .markdown-body dl dt {
    padding: 0;
    margin-top: 16px;
    font-size: 1em;
    font-style: italic;
    font-weight: 600;
  }

  .markdown-body dl dd {
    padding: 0 16px;
    margin-bottom: 16px;
  }

  .markdown-body table {
    display: block;
    width: 100%;
    overflow: auto;
  }

  .markdown-body table th {
    font-weight: 600;
  }

  .markdown-body table td,
  .markdown-body table th {
    padding: 6px 13px;
    border: 1px solid #dfe2e5;
  }

  .markdown-body table tr {
    background-color: #fff;
    border-top: 1px solid #c6cbd1;
  }

  .markdown-body table tr:nth-child(2n) {
    background-color: #f6f8fa;
  }

  .markdown-body img {
    max-width: 100%;
    box-sizing: initial;
    background-color: #fff;
  }

  .markdown-body img[align=right] {
    padding-left: 20px;
  }

  .markdown-body img[align=left] {
    padding-right: 20px;
  }

  .markdown-body code {
    padding: .2em .4em;
    margin: 0;
    font-size: 85%;
    background-color: rgba(27,31,35,.05);
    border-radius: 3px;
  }

  .markdown-body pre {
    word-wrap: normal;
  }

  .markdown-body pre>code {
    padding: 0;
    margin: 0;
    font-size: 100%;
    word-break: normal;
    white-space: pre;
    background: transparent;
    border: 0;
  }

  .markdown-body .highlight {
    margin-bottom: 16px;
  }

  .markdown-body .highlight pre {
    margin-bottom: 0;
    word-break: normal;
  }

  .markdown-body .highlight pre,
  .markdown-body pre {
    padding: 16px;
    overflow: auto;
    font-size: 85%;
    line-height: 1.45;
    background-color: #f6f8fa;
    border-radius: 3px;
  }

  .markdown-body pre code {
    display: inline;
    max-width: auto;
    padding: 0;
    margin: 0;
    overflow: visible;
    line-height: inherit;
    word-wrap: normal;
    background-color: initial;
    border: 0;
  }

  .markdown-body .commit-tease-sha {
    display: inline-block;
    font-family: SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;
    font-size: 90%;
    color: #444d56;
  }

  .markdown-body .full-commit .btn-outline:not(:disabled):hover {
    color: #005cc5;
    border-color: #005cc5;
  }

  .markdown-body .blob-wrapper {
    overflow-x: auto;
    overflow-y: hidden;
  }

  .markdown-body .blob-wrapper-embedded {
    max-height: 240px;
    overflow-y: auto;
  }

  .markdown-body .blob-num {
    width: 1%;
    min-width: 50px;
    padding-right: 10px;
    padding-left: 10px;
    font-family: SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;
    font-size: 12px;
    line-height: 20px;
    color: rgba(27,31,35,.3);
    text-align: right;
    white-space: nowrap;
    vertical-align: top;
    cursor: pointer;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
  }

  .markdown-body .blob-num:hover {
    color: rgba(27,31,35,.6);
  }

  .markdown-body .blob-num:before {
    content: attr(data-line-number);
  }

  .markdown-body .blob-code {
    position: relative;
    padding-right: 10px;
    padding-left: 10px;
    line-height: 20px;
    vertical-align: top;
  }

  .markdown-body .blob-code-inner {
    overflow: visible;
    font-family: SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;
    font-size: 12px;
    color: #24292e;
    word-wrap: normal;
    white-space: pre;
  }

  .markdown-body .pl-token.active,
  .markdown-body .pl-token:hover {
    cursor: pointer;
    background: #ffea7f;
  }

  .markdown-body .tab-size[data-tab-size="1"] {
    -moz-tab-size: 1;
    tab-size: 1;
  }

  .markdown-body .tab-size[data-tab-size="2"] {
    -moz-tab-size: 2;
    tab-size: 2;
  }

  .markdown-body .tab-size[data-tab-size="3"] {
    -moz-tab-size: 3;
    tab-size: 3;
  }

  .markdown-body .tab-size[data-tab-size="4"] {
    -moz-tab-size: 4;
    tab-size: 4;
  }

  .markdown-body .tab-size[data-tab-size="5"] {
    -moz-tab-size: 5;
    tab-size: 5;
  }

  .markdown-body .tab-size[data-tab-size="6"] {
    -moz-tab-size: 6;
    tab-size: 6;
  }

  .markdown-body .tab-size[data-tab-size="7"] {
    -moz-tab-size: 7;
    tab-size: 7;
  }

  .markdown-body .tab-size[data-tab-size="8"] {
    -moz-tab-size: 8;
    tab-size: 8;
  }

  .markdown-body .tab-size[data-tab-size="9"] {
    -moz-tab-size: 9;
    tab-size: 9;
  }

  .markdown-body .tab-size[data-tab-size="10"] {
    -moz-tab-size: 10;
    tab-size: 10;
  }

  .markdown-body .tab-size[data-tab-size="11"] {
    -moz-tab-size: 11;
    tab-size: 11;
  }

  .markdown-body .tab-size[data-tab-size="12"] {
    -moz-tab-size: 12;
    tab-size: 12;
  }

  .markdown-body .task-list-item {
    list-style-type: none;
  }

  .markdown-body .task-list-item+.task-list-item {
    margin-top: 3px;
  }

  .markdown-body .task-list-item input {
    margin: 0 .2em .25em -1.6em;
    vertical-align: middle;
  }
</style>
</head><body><article class="markdown-body"><h1><a id="user-content-overview" class="anchor" aria-hidden="true" href="#overview"><span aria-hidden="true" class="octicon octicon-link"></span></a>Overview</h1>
<p>You may have noticed errors similar to this at the end of your run:</p>
<div class="highlight highlight-source-shell"><pre>ERROR: <span class="pl-k">~</span>List: Condition <span class="pl-s"><span class="pl-pds">"</span>_first != __null<span class="pl-pds">"</span></span> is true.
   At: ./core/self_list.h:112.
WARNING: cleanup: ObjectDB Instances still exist<span class="pl-k">!</span>
   At: core/object.cpp:2071.
ERROR: clear: Resources Still <span class="pl-k">in</span> use at Exit<span class="pl-k">!</span>
   At: core/resource.cpp:476.</pre></div>
<p>These indicate that when the tests finished running there were existing objects that had not been freed.  As of 7.0.0 GUT no longer causes any leaks on its own.</p>
<p>Starting in 7.0.0 GUT also provides utilities for tracking down memory leaks and managing test objects.  These features include:</p>
<ul>
<li>Printing the count of orphans created by a test</li>
<li>Methods to ease freeing objects
<ul>
<li><code>autofree</code></li>
<li><code>autoqfree</code></li>
<li><code>add_child_autofree</code></li>
<li><code>add_child_autoqfree</code></li>
</ul>
</li>
</ul>
<p>At the <a href="#memory_mgmt">bottom of the page</a> is my attempt to describe how Godot does memory management.  If any of these sections seem confusing, read that part first.  The <a href="https://docs.godotengine.org/en/stable/getting_started/scripting/gdscript/gdscript_basics.html#memory-management" rel="nofollow">Godot docs</a> have some infomration.  Also, here's a <a href="https://www.youtube.com/watch?v=cl2PxGkpJdo" rel="nofollow">tutorial</a> on memory management I found.</p>
<h1><a id="user-content-gut-orphan-count" class="anchor" aria-hidden="true" href="#gut-orphan-count"><span aria-hidden="true" class="octicon octicon-link"></span></a>GUT Orphan Count</h1>
<p>GUT, by default, will print a count of any orphans that are created by a test.  Depending on the log level these counts will appear after each test or may just appear after each script.  GUT counts the orphans before each test and warns when the value changes when a test is done.  These counts are summed up for each script as well and a grand total is printed at the end of the run.  You can disable this feature if you want to.</p>
<p>Godot considers an object to be orphaned if it extends <code>Object</code> (but not <code>Reference</code>) and has not been added to the tree.  Godot provides the <code>print_stray_nodes</code> which will print a list of all nodes (and their children) that are not in the tree.  This information is a bit cryptic and can only be printed to the console and command line.  You can also use the <code>Performance</code> object to get a count of orphans at any particular time.</p>
<pre><code>var count = Performance.get_monitor(Performance.OBJECT_ORPHAN_NODE_COUNT)
</code></pre>
<h1><a id="user-content-freeing-test-objects" class="anchor" aria-hidden="true" href="#freeing-test-objects"><span aria-hidden="true" class="octicon octicon-link"></span></a>Freeing Test Objects</h1>
<p>Freeing up objects in your tests is tedious.  It adds additional lines of code that don't add anything to the test.  To aid in this GUT provides the <code>autofree</code> and <code>autoqfree</code> functions.  Anything passed to these methods will be freed up after the test runs.  These methods also <code>return</code> whatever is passed into them so you can chain them together to cut down on space.</p>
<pre><code>var Foo = load('res://foo.gd')
var node = autofree(Node.new())
var bar_scene = autofree(load('res://bar.tscn').instance())
assert_null(autofree(Foo.new()).get_value(), 'default value is null')
</code></pre>
<p><code>autofree</code> will call <code>free</code> on the object (if it is valid to) at the end of the test.  <code>autoqfree</code> will call <code>queue_free</code> on the object at the end of the test.  These objects are freed before the orphans are counted and will now show up in the count.  If <code>autoqfree</code> is called at anytime during a test GUT will pause briefly to give the <code>queue_free</code> time to execute, then it will count orphans.</p>
<p>These functions can be used in a test or the <code>before_each</code> but should NOT be used in <code>before_all</code>.  If you create an object in <code>before_all</code> you must free it yourself in <code>after_all</code>.  Using either flavor of <code>autofree</code> in <code>before_all</code> will cause the object to be freed after the first test is run.</p>
<h1><a id="user-content-using-add_child-in-tests" class="anchor" aria-hidden="true" href="#using-add_child-in-tests"><span aria-hidden="true" class="octicon octicon-link"></span></a>Using <code>add_child</code> in Tests</h1>
<p>When you call <code>add_child</code> from within a test the object is added as a child of the test script.  The test script is a child of the GUT gui.  Any child you add to a test will not be freed until the end of the test run.  GUT holds onto the test scripts until the end for summary inforation.  GUT will output a warning if a test script has children when it finishes running.</p>
<p>It is best to free any children you add in a test in that same test.  GUT has two helper functions that will add the child and free the child after the test.  These are <code>add_child_autofree</code> and <code>add_child_autoqfree</code>.  These work the same way as <code>autofree</code> and <code>autoqfree</code> but take the additional step of calling <code>add_child</code>.  These methods also return whatever is passed to them so you can cut down on lines of code.</p>
<pre><code>func test_foo():
  var node = add_child_autofree(Node.new())
  var node2 = add_child_autoqfree(Node.new())
</code></pre>
<p>These functions can be used in a test or the <code>before_each</code> but should NOT be used in <code>before_all</code>.  If you have an object you want to add as a child in <code>before_all</code> you must free it yourself in <code>after_all</code>.  Using either flavor of <code>add_child_autofree</code> in <code>before_all</code> will cause the object to be freed after the first test is run.</p>
<h1><a id="user-content-freeing-globals" class="anchor" aria-hidden="true" href="#freeing-globals"><span aria-hidden="true" class="octicon octicon-link"></span></a>Freeing Globals</h1>
<p>You can use a <a href="Hooks#postrun">post-run hook</a> to clean up any global objects you have created.  If you are running your tests through a scene then you may have to recreate these objects if you want to be able to perform multiple test runs through the GUI.  You could use a <a href="Hooks#prerun">pre-run hook</a> to do this, but it all starts getting messy at that point.</p>
<h1><a id="user-content-automatically-freed-objects" class="anchor" aria-hidden="true" href="#automatically-freed-objects"><span aria-hidden="true" class="octicon octicon-link"></span></a>Automatically Freed Objects</h1>
<p>To help with freeing up objects GUT will automatically free the following objects at the end of the test.</p>
<ul>
<li><a href="Doubles">Doubles</a></li>
<li><a href="Partial-Doubles">Partial Doubles</a></li>
</ul>
<p>Calling <code>autofree</code> with one of these objects, or manually freeing them yourself will not have any adverse effects.</p>
<h1><a id="user-content-testing-for-leaks" class="anchor" aria-hidden="true" href="#testing-for-leaks"><span aria-hidden="true" class="octicon octicon-link"></span></a><a name="user-content-testing_for_leaks">Testing for Leaks</a></h1>
<p>GUT provides the <code>assert_no_new_orphans</code> method that will assert that the test has not created any new orphans.  Using this can be a little tricky in complicated test scripts.</p>
<p><code>assert_no_new_orphans</code> strictly validates that at the time it executes the count of of orphans found is the same as before the test was run.  The "before" count is taken prior to executing <code>before_each</code>.  It is recommended that these types of tests are done in an <a href="Inner-Test-Classes">Inner Test Class</a> or standalone script where it is less likely that a <code>before_each</code> or <code>before_all</code> would introduce orphans causing false positives.</p>
<p><code>assert_no_new_orphans</code> cannot take into account anything you have called <code>autofree</code> on.  For one, it's impossible, and it wouldn't tell you much since freeing that object could cause leaks.</p>
<p>A standard memory leak test will create an object, free it, and then verify that you have not created any new orphans.  Based on some bad practices I've done myself I would advise creating tests with and without using <code>add_child</code>.</p>
<div class="highlight highlight-source-gdscript"><pre><span class="pl-c"><span class="pl-c">#</span> res://test/unit/test_foo.gd</span>
<span class="pl-k">extends</span><span class="pl-e"> GutTest</span>
...

<span class="pl-k">class</span> <span class="pl-en">TestLeaks</span>:
    <span class="pl-k">extends</span><span class="pl-e"> GutTest</span>
    <span class="pl-k">var</span> <span class="pl-c1">Foo</span> <span class="pl-k">=</span> <span class="pl-c1">load</span>(<span class="pl-s">'res://foo.gd'</span>)

    <span class="pl-k">func</span> <span class="pl-en">test_no_leaks</span>():
        <span class="pl-k">var</span> to_free <span class="pl-k">=</span> <span class="pl-c1">Foo</span>.<span class="pl-c1">new</span>()
        to_free.<span class="pl-c1">free</span>()
        <span class="pl-c1">assert_not_new_orphans</span>()

    <span class="pl-k">func</span> <span class="pl-en">test_no_leaks_with_add_child</span>():
        <span class="pl-k">var</span> to_free <span class="pl-k">=</span> <span class="pl-c1">Foo</span>.<span class="pl-c1">new</span>()
        <span class="pl-c1">add_child</span>(to_free)
        to_free.<span class="pl-c1">free</span>()
        <span class="pl-c1">assert_no_new_orphans</span>()</pre></div>
<p>If you must use <code>queue_free</code> instead of <code>free</code> in your test then you will have to pause before asserting that no orphans have been created.  You can do this with <code>yield</code></p>
<div class="highlight highlight-source-gdscript"><pre><span class="pl-k">func</span> <span class="pl-en">test_no_orphans_queue_free</span>();
  <span class="pl-k">var</span> node <span class="pl-k">=</span> <span class="pl-c1">Node</span>.<span class="pl-c1">new</span>()
  node.<span class="pl-c1">queue_free</span>()
  <span class="pl-c1">assert_no_new_orphans</span>(<span class="pl-s">'this will fail'</span>)
  <span class="pl-k">yield</span>(<span class="pl-c1">yield_for</span>(.<span class="pl-c1">2</span>), <span class="pl-k">YIELD</span>)
  <span class="pl-c1">assert_no_new_orphans</span>(<span class="pl-s">'this one passes'</span>)</pre></div>
<h1><a id="user-content-godot-memory-management" class="anchor" aria-hidden="true" href="#godot-memory-management"><span aria-hidden="true" class="octicon octicon-link"></span></a><a name="user-content-memory_mgmt">Godot Memory Management</a></h1>
<p>Godot treats <code>Object</code> and <code>Reference</code> instances differently for memory management.  The confusing part is that <code>Reference</code> extends <code>Object</code>.  Most of the time you don't have to worry about anything that extends <code>Reference</code>.  But if it extends <code>Object</code> (and not <code>Reference</code>) you must free it yourself or it, and all its parts, will stay around until you exit the game.</p>
<h4><a id="user-content-reference" class="anchor" aria-hidden="true" href="#reference"><span aria-hidden="true" class="octicon octicon-link"></span></a>Reference</h4>
<p>Any class/script that extends Reference is managed via reference counts.  As you add variables that "point" to an object, the reference count increases.  As these variables go out of scope or are changed the reference count is decreased.  When the count hits 0, the object is freed automatically.</p>
<p>For the most part you don't have to worry about this.  It just works.  These reference counts can become an indirect leak if you do not free an <code>Object</code> that has variables pointing to <code>Reference</code> instances.  References can become leaks if there are cyclical references of objects that prevent each other from being freed.  <code>weakref</code> is useful in these cases.  Currently there is no way to get any additional information about instances of Reference from the engine.</p>
<pre><code># makes a new Reference object and returns a reference to it.  The reference
# count is now 1
var ref1 = Reference.new() # lets call this [Reference:1]
# Make another variable that "points" to the object above.
var ref1_1 = ref1 # [Reference:1] now has a reference count of 2

if(true):
  var ref_in_if = ref1 # now the count is 3

# now we are back to 2 since ref_in_if went out of scope
print('out of if')

ref1_1 = null # the count is now 1
ref1 = null # [Reference:1] will now be freed
</code></pre>
<h4><a id="user-content-weakref" class="anchor" aria-hidden="true" href="#weakref"><span aria-hidden="true" class="octicon octicon-link"></span></a>Weakref</h4>
<p>There can be situations where cyclical references will prevent a <code>Reference</code> from being freed.  To help in these situations Godot has the <a href="https://docs.godotengine.org/en/stable/classes/class_weakref.html" rel="nofollow"><code>weakref</code></a> function.</p>
<p>The <code>weakref</code> function will return you an object that points to a reference but does not increase the reference count.  This allows you to point at an object without preventing it from being freed automatically.  You must take this into account though and verify that the object still exists when you want to get the reference back out of the <code>weakref</code>.</p>
<pre><code>var foo = Foo.new() # where Foo extends Reference
foo.set_bar('hello world')
var wref = weakref(foo)

...

# this line increases the reference count until ref_of_wref goes out of scope
var ref_of_wref = wref.get_ref()
if(is_instance_valid(ref_of_wref)):
  print(ref_of_wref.get_bar()) # prints 'hello world' if ref hasn't been freed already.
</code></pre>
<h4><a id="user-content-object-except-reference" class="anchor" aria-hidden="true" href="#object-except-reference"><span aria-hidden="true" class="octicon octicon-link"></span></a>Object (except Reference)</h4>
<p>Anything that extends <code>Object</code> (directly or indirectly) but DOES NOT extend <code>Reference</code> must be freed manually.  Any of these objects that are not in the main tree are considered orphaned.  Any children of these objects are also considered orphans.  You can free these objects by calling <code>free</code> or <code>queue_free</code>.  You can see a list of orphans by using <code>print_stray_nodes</code>.</p>
</article></body>